!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).smartnavx=e()}(this,(function(){"use strict";var t=e;function e(t,i){if(!(this instanceof e))return new e(t,i);if(Array.isArray(t)||(i=t,t=[]),i=i||{},this.data=t||[],this.length=this.data.length,this.compare=i.compare||r,this.setNodeId=i.setNodeId||n,this.length>0)for(var o=this.length>>1;o>=0;o--)this._down(o);if(i.setNodeId)for(o=0;o<this.length;++o)this.setNodeId(this.data[o],o)}function n(){}function r(t,e){return t-e}function i(t){this.node=t,this.parent=null,this.closed=!1,this.open=0,this.distanceToSource=Number.POSITIVE_INFINITY,this.fScore=Number.POSITIVE_INFINITY,this.heapIndex=-1}e.prototype={push:function(t){this.data.push(t),this.setNodeId(t,this.length),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this.setNodeId(this.data[0],0),this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},updateItem:function(t){this._down(t),this._up(t)},_up:function(t){for(var e=this.data,n=this.compare,r=this.setNodeId,i=e[t];t>0;){var o=t-1>>1,s=e[o];if(n(i,s)>=0)break;e[t]=s,r(s,t),t=o}e[t]=i,r(i,t)},_down:function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t],o=this.setNodeId;t<r;){var s=1+(t<<1),a=s+1,c=e[s];if(a<this.length&&n(e[a],c)<0&&(s=a,c=e[a]),n(c,i)>=0)break;e[t]=c,o(c,t),t=s}e[t]=i,o(i,t)}};var o=function(){var t=0,e=[];return{createNewState:function(n){var r=e[t];r?(r.node=n,r.parent=null,r.closed=!1,r.open=0,r.distanceToSource=Number.POSITIVE_INFINITY,r.fScore=Number.POSITIVE_INFINITY,r.heapIndex=-1):(r=new i(n),e[t]=r);return t++,r},reset:function(){t=0}}},s=function(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},a=function(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.abs(n)+Math.abs(r)};var c=[];"function"==typeof Object.freeze&&Object.freeze(c);var h={heuristic:function(){return 0},distance:function(){return 1},compareFScore:function(t,e){return t.fScore-e.fScore},NO_PATH:c,setHeapIndex:function(t,e){t.heapIndex=e},setH1:function(t,e){t.h1=e},setH2:function(t,e){t.h2=e},compareF1Score:function(t,e){return t.f1-e.f1},compareF2Score:function(t,e){return t.f2-e.f2}};var u=function(e,n){var r=(n=n||{}).oriented,i=n.heuristic;i||(i=h.heuristic);var s=n.distance;s||(s=h.distance);var a=o();return{find:function(n,o){var c=e.getNode(n);if(!c)throw new Error("fromId is not defined in this graph: "+n);var u=e.getNode(o);if(!u)throw new Error("toId is not defined in this graph: "+o);a.reset();var d,p=new Map,g=new t({compare:h.compareFScore,setNodeId:h.setHeapIndex}),y=a.createNewState(c);p.set(n,y),y.fScore=i(c,u),y.distanceToSource=0,g.push(y),y.open=1;for(;g.length>0;){if(d=g.pop(),m=u,d.node===m)return f(d);d.closed=!0,e.forEachLinkedNode(d.node.id,v,r)}var m;return l;function v(t,e){var n=p.get(t.id);if(n||(n=a.createNewState(t),p.set(t.id,n)),!n.closed){0===n.open&&(g.push(n),n.open=1);var r=d.distanceToSource+s(t,d.node,e);r>=n.distanceToSource||(n.parent=d,n.distanceToSource=r,n.fScore=r+i(n.node,u),g.updateItem(n.heapIndex))}}}}},l=h.NO_PATH,d=s,p=a;function f(t){for(var e=[t.node],n=t.parent;n;)e.push(n.node),n=n.parent;return e}u.l2=d,u.l1=p;var g=function(e,n){var r=(n=n||{}).oriented,i=n.heuristic;i||(i=h.heuristic);var s=n.distance;s||(s=h.distance);var a=o();return{find:function(n,o){var c=e.getNode(n);if(!c)throw new Error("fromId is not defined in this graph: "+n);var u=e.getNode(o);if(!u)throw new Error("toId is not defined in this graph: "+o);if(c===u)return[c];a.reset();var l=r?function(t,e){if(1===E){if(e.fromId===k.node.id)return L(t,e,k)}else if(2===E&&e.toId===k.node.id)return L(t,e,k)}:function(t,e){return L(t,e,k)},d=new Map,p=new t({compare:h.compareFScore,setNodeId:h.setHeapIndex}),f=new t({compare:h.compareFScore,setNodeId:h.setHeapIndex}),g=a.createNewState(c);d.set(n,g),g.fScore=i(c,u),g.distanceToSource=0,p.push(g),g.open=1;var m=a.createNewState(u);m.fScore=i(u,c),m.distanceToSource=0,f.push(m),m.open=2;var v,b,w=Number.POSITIVE_INFINITY,x=p,E=1;for(;p.length>0&&f.length>0;){p.length<f.length?(E=1,x=p):(E=2,x=f);var k=x.pop();if(k.closed=!0,!(k.distanceToSource>w)&&(e.forEachLinkedNode(k.node.id,l),v&&b))return N(v,b)}return y;function N(t,e){for(var n=[],r=t;r;)n.push(r.node),r=r.parent;for(var i=e;i;)n.unshift(i.node),i=i.parent;return n}function L(t,e,n){var r=d.get(t.id);if(r||(r=a.createNewState(t),d.set(t.id,r)),!r.closed)if((h=r.open)&&h!==E){var o=r.distanceToSource+n.distanceToSource;o<w&&(v=r,b=n,w=o)}else{var h,l=n.distanceToSource+s(r.node,n.node,e);if(!(l>=r.distanceToSource)){var p=1===E?u:c,f=l+i(r.node,p);f>=w||(r.fScore=f,0===r.open&&(x.push(r),x.updateItem(r.heapIndex),r.open=E),r.parent=n,r.distanceToSource=l)}}}}}},y=h.NO_PATH,m=s,v=a;g.l2=m,g.l1=v;var b=function(){var t=0,e=[];return{createNewState:function(n){var r=e[t];r?(r.node=n,r.p1=null,r.p2=null,r.closed=!1,r.g1=Number.POSITIVE_INFINITY,r.g2=Number.POSITIVE_INFINITY,r.f1=Number.POSITIVE_INFINITY,r.f2=Number.POSITIVE_INFINITY,r.h1=-1,r.h2=-1):(r=new w(n),e[t]=r);return t++,r},reset:function(){t=0}}};function w(t){this.node=t,this.p1=null,this.p2=null,this.closed=!1,this.g1=Number.POSITIVE_INFINITY,this.g2=Number.POSITIVE_INFINITY,this.f1=Number.POSITIVE_INFINITY,this.f2=Number.POSITIVE_INFINITY,this.h1=-1,this.h2=-1}var x=function(e,n){var r=(n=n||{}).oriented,i=n.quitFast,o=n.heuristic;o||(o=h.heuristic);var s=n.distance;s||(s=h.distance);var a=b();return{find:function(n,c){var u=e.getNode(n);if(!u)throw new Error("fromId is not defined in this graph: "+n);var l=e.getNode(c);if(!l)throw new Error("toId is not defined in this graph: "+c);a.reset();var d,p=r?function(t,e){if(e.fromId===k.node.id)return S(t,e)}:S,f=r?function(t,e){if(e.toId===k.node.id)return T(t,e)}:T,g=new Map,y=new t({compare:h.compareF1Score,setNodeId:h.setH1}),m=new t({compare:h.compareF2Score,setNodeId:h.setH2}),v=Number.POSITIVE_INFINITY,b=a.createNewState(u);g.set(n,b),b.g1=0;var w=o(u,l);b.f1=w,y.push(b);var x=a.createNewState(l);g.set(c,x),x.g2=0;var k,N=w;x.f2=N,m.push(x);for(;m.length&&y.length&&(y.length<m.length?L():C(),!i||!d););return function(t){if(!t)return E;var e=[t.node],n=t.p1;for(;n;)e.push(n.node),n=n.p1;var r=t.p2;for(;r;)e.unshift(r.node),r=r.p2;return e}(d);function L(){(k=y.pop()).closed||(k.closed=!0,k.f1<v&&k.g1+N-o(u,k.node)<v&&e.forEachLinkedNode(k.node.id,p),y.length>0&&(w=y.peek().f1))}function C(){(k=m.pop()).closed||(k.closed=!0,k.f2<v&&k.g2+w-o(k.node,l)<v&&e.forEachLinkedNode(k.node.id,f),m.length>0&&(N=m.peek().f2))}function S(t,e){var n=g.get(t.id);if(n||(n=a.createNewState(t),g.set(t.id,n)),!n.closed){var r=k.g1+s(k.node,t,e);r<n.g1&&(n.g1=r,n.f1=r+o(n.node,l),n.p1=k,n.h1<0?y.push(n):y.updateItem(n.h1));var i=n.g1+n.g2;i<v&&(v=i,d=n)}}function T(t,e){var n=g.get(t.id);if(n||(n=a.createNewState(t),g.set(t.id,n)),!n.closed){var r=k.g2+s(k.node,t,e);r<n.g2&&(n.g2=r,n.f2=r+o(u,n.node),n.p2=k,n.h2<0?m.push(n):m.updateItem(n.h2));var i=n.g1+n.g2;i<v&&(v=i,d=n)}}}}},E=h.NO_PATH,k=s,N=a;x.l2=k,x.l1=N;var L={aStar:u,aGreedy:g,nba:x}.aStar;function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var S,T={meters:6371008.8,metres:6371008.8,millimeters:6371008800,millimetres:6371008800,centimeters:637100880,centimetres:637100880,kilometers:6371.0088,kilometres:6371.0088,miles:3958.761333810546,nauticalmiles:6371008.8/1852,inches:6371008.8*39.37,yards:6371008.8/1.0936,feet:20902260.511392,radians:1,degrees:6371008.8/111325};function I(t,e,n){if(!F(n=n||{}))throw new Error("options is invalid");var r=n.bbox,i=n.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");r&&D(r),i&&j(i);var o={type:"Feature"};return i&&(o.id=i),r&&(o.bbox=r),o.properties=e||{},o.geometry=t,o}function R(t,e,n){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!O(t[0])||!O(t[1]))throw new Error("coordinates must contain numbers");return I({type:"Point",coordinates:t},e,n)}function _(t,e,n){if(!t)throw new Error("coordinates is required");if(t.length<2)throw new Error("coordinates must be an array of two or more positions");if(!O(t[0][1])||!O(t[0][1]))throw new Error("coordinates must contain numbers");return I({type:"LineString",coordinates:t},e,n)}function A(t,e){if(!F(e=e||{}))throw new Error("options is invalid");var n=e.bbox,r=e.id;if(!t)throw new Error("No features passed");if(!Array.isArray(t))throw new Error("features must be an Array");n&&D(n),r&&j(r);var i={type:"FeatureCollection"};return r&&(i.id=r),n&&(i.bbox=n),i.features=t,i}function P(t,e){if(null==t)throw new Error("distance is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var n=T[e||"kilometers"];if(!n)throw new Error(e+" units is invalid");return t/n}function M(t){if(null==t)throw new Error("radians is required");return 180*(t%(2*Math.PI))/Math.PI}function B(t){if(null==t)throw new Error("degrees is required");return t%360*Math.PI/180}function O(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function F(t){return!!t&&t.constructor===Object}function D(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!O(t))throw new Error("bbox must only contain numbers")}))}function j(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(C(t)))throw new Error("id must be a number or a string")}function q(t){if(!t)throw new Error("coord is required");if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates;if(Array.isArray(t)&&t.length>=2&&void 0===t[0].length&&void 0===t[1].length)return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function U(t){if(!t)throw new Error("coords is required");if("Feature"===t.type&&null!==t.geometry)return t.geometry.coordinates;if(t.coordinates)return t.coordinates;if(Array.isArray(t))return t;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function G(t,e){if(!t)throw new Error((e||"geojson")+" is required");if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error((e||"geojson")+" is invalid")}function H(t,e,n){if(!F(n=n||{}))throw new Error("options is invalid");if(!0===n.final)return function(t,e){var n=H(e,t);return n=(n+180)%360}(t,e);var r=q(t),i=q(e),o=B(r[0]),s=B(i[0]),a=B(r[1]),c=B(i[1]),h=Math.sin(s-o)*Math.cos(c),u=Math.cos(a)*Math.sin(c)-Math.sin(a)*Math.cos(c)*Math.cos(s-o);return M(Math.atan2(h,u))}function Y(t,e,n){if(!F(n=n||{}))throw new Error("options is invalid");var r=n.units,i=q(t),o=q(e),s=B(o[1]-i[1]),a=B(o[0]-i[0]),c=B(i[1]),h=B(o[1]),u=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(c)*Math.cos(h);return function(t,e){if(null==t)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var n=T[e||"kilometers"];if(!n)throw new Error(e+" units is invalid");return t*n}(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r)}function V(t,e,n,r){if(!F(r=r||{}))throw new Error("options is invalid");var i=r.units,o=r.properties,s=q(t),a=B(s[0]),c=B(s[1]),h=B(n),u=P(e,i),l=Math.asin(Math.sin(c)*Math.cos(u)+Math.cos(c)*Math.sin(u)*Math.cos(h));return R([M(a+Math.atan2(Math.sin(h)*Math.sin(u)*Math.cos(c),Math.cos(u)-Math.sin(c)*Math.sin(l))),M(l)],o)}function X(t,e,n,r){if(!F(r=r||{}))throw new Error("options is invalid");var i,o=[];if("Feature"===t.type)i=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");i=t.coordinates}for(var s,a,c,h=0,u=0;u<i.length&&!(e>=h&&u===i.length-1);u++){if(h>e&&0===o.length){if(!(s=e-h))return o.push(i[u]),_(o);a=H(i[u],i[u-1])-180,c=V(i[u],s,a,r),o.push(c.geometry.coordinates)}if(h>=n)return(s=n-h)?(a=H(i[u],i[u-1])-180,c=V(i[u],s,a,r),o.push(c.geometry.coordinates),_(o)):(o.push(i[u]),_(o));if(h>=e&&o.push(i[u]),u===i.length-1)return _(o);h+=Y(i[u],i[u+1],r)}return _(i[i.length-1])}function J(t,e,n,r,i){!function t(e,n,r,i,o){for(;i>r;){if(i-r>600){var s=i-r+1,a=n-r+1,c=Math.log(s),h=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*h*(s-h)/s)*(a-s/2<0?-1:1),l=Math.max(r,Math.floor(n-a*h/s+u)),d=Math.min(i,Math.floor(n+(s-a)*h/s+u));t(e,n,l,d,o)}var p=e[n],f=r,g=i;for(W(e,r,n),o(e[i],p)>0&&W(e,r,i);f<g;){for(W(e,f,g),f++,g--;o(e[f],p)<0;)f++;for(;o(e[g],p)>0;)g--}0===o(e[r],p)?W(e,r,g):(g++,W(e,g,i)),g<=n&&(r=g+1),n<=g&&(i=g-1)}}(t,e,n||0,r||t.length-1,i||z)}function W(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function z(t,e){return t<e?-1:t>e?1:0}function Q(t,e){if(!(this instanceof Q))return new Q(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function $(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function K(t,e){Z(t,0,t.children.length,e,t)}function Z(t,e,n,r,i){i||(i=at(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=e;s<n;s++)o=t.children[s],tt(i,t.leaf?r(o):o);return i}function tt(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function et(t,e){return t.minX-e.minX}function nt(t,e){return t.minY-e.minY}function rt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function it(t){return t.maxX-t.minX+(t.maxY-t.minY)}function ot(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function st(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function at(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ct(t,e,n,r,i){for(var o,s=[e,n];s.length;)(n=s.pop())-(e=s.pop())<=r||(J(t,o=e+Math.ceil((n-e)/r/2)*r,e,n,i),s.push(e,o,o,n))}function ht(t,e,n){if(null!==t)for(var r,i,o,s,a,c,h,u,l=0,d=0,p=t.type,f="FeatureCollection"===p,g="Feature"===p,y=f?t.features.length:1,m=0;m<y;m++){a=(u=!!(h=f?t.features[m].geometry:g?t.geometry:t)&&"GeometryCollection"===h.type)?h.geometries.length:1;for(var v=0;v<a;v++){var b=0,w=0;if(null!==(s=u?h.geometries[v]:h)){c=s.coordinates;var x=s.type;switch(l=!n||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":if(!1===e(c,d,m,b,w))return!1;d++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<c.length;r++){if(!1===e(c[r],d,m,b,w))return!1;d++,"MultiPoint"===x&&b++}"LineString"===x&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<c.length;r++){for(i=0;i<c[r].length-l;i++){if(!1===e(c[r][i],d,m,b,w))return!1;d++}"MultiLineString"===x&&b++,"Polygon"===x&&w++}"Polygon"===x&&b++;break;case"MultiPolygon":for(r=0;r<c.length;r++){for("MultiPolygon"===x&&(w=0),i=0;i<c[r].length;i++){for(o=0;o<c[r][i].length-l;o++){if(!1===e(c[r][i][o],d,m,b,w))return!1;d++}w++}b++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===ht(s.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ut(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function lt(t,e){!function(t,e){var n,r,i,o,s,a,c,h,u,l,d=0,p="FeatureCollection"===t.type,f="Feature"===t.type,g=p?t.features.length:1;for(n=0;n<g;n++){for(a=p?t.features[n].geometry:f?t.geometry:t,h=p?t.features[n].properties:f?t.properties:{},u=p?t.features[n].bbox:f?t.bbox:void 0,l=p?t.features[n].id:f?t.id:void 0,s=(c=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,i=0;i<s;i++)if(null!==(o=c?a.geometries[i]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,d,h,u,l))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],d,h,u,l))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,d,h,u,l))return!1;d++}}(t,(function(t,n,r,i,o){var s,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==e(I(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var c=0;c<t.coordinates.length;c++){var h=t.coordinates[c];if(!1===e(I({type:s,coordinates:h},r),n,c))return!1}}))}function dt(t,e,n){var r=n,i=!1;return function(t,e){lt(t,(function(t,n,r){var i=0;if(t.geometry){var o,s=t.geometry.type;if("Point"!==s&&"MultiPoint"!==s)return!1!==ht(t,(function(s,a,c,h,u){if(void 0!==o){var l=_([o,s],t.properties);if(!1===e(l,n,r,u,i))return!1;i++,o=s}else o=s}))&&void 0}}))}(t,(function(t,o,s,a,c){r=!1===i&&void 0===n?t:e(r,t,o,s,a,c),i=!0})),r}function pt(t){var e=Q(t);return e.insert=function(t){if(Array.isArray(t)){var e=t;(t=ft(e)).bbox=e}else t.bbox=t.bbox?t.bbox:gt(t);return Q.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){var n=ft(t);n.bbox=t,e.push(n)})):ut(t,(function(t){t.bbox=t.bbox?t.bbox:gt(t),e.push(t)})),Q.prototype.load.call(this,e)},e.remove=function(t){if(Array.isArray(t)){var e=t;(t=ft(e)).bbox=e}return Q.prototype.remove.call(this,t)},e.clear=function(){return Q.prototype.clear.call(this)},e.search=function(t){return{type:"FeatureCollection",features:Q.prototype.search.call(this,this.toBBox(t))}},e.collides=function(t){return Q.prototype.collides.call(this,this.toBBox(t))},e.all=function(){return{type:"FeatureCollection",features:Q.prototype.all.call(this)}},e.toJSON=function(){return Q.prototype.toJSON.call(this)},e.fromJSON=function(t){return Q.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;return{minX:(e=t.bbox?t.bbox:Array.isArray(t)&&4===t.length?t:gt(t))[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}function ft(t){var e=[t[0],t[1]],n=[t[0],t[3]],r=[t[2],t[3]];return{type:"Feature",bbox:t,properties:{},geometry:{type:"Polygon",coordinates:[[e,[t[2],t[1]],r,n,e]]}}}function gt(t){var e=[1/0,1/0,-1/0,-1/0];return ht(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function yt(t){var e=[1/0,1/0,-1/0,-1/0];return ht(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function mt(t,e){if(!F(e=e||{}))throw new Error("options is invalid");var n=e.precision,r=e.coordinates,i=e.mutate;if(n=null==n||isNaN(n)?6:n,r=null==r||isNaN(r)?3:r,!t)throw new Error("<geojson> is required");if("number"!=typeof n)throw new Error("<precision> must be a number");if("number"!=typeof r)throw new Error("<coordinates> must be a number");!1!==i&&void 0!==i||(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,n);return ht(t,(function(t){!function(t,e,n){t.length>n&&t.splice(n,t.length);for(var r=0;r<t.length;r++)t[r]=Math.round(t[r]*e)/e}(t,o,r)})),t}function vt(t){if(!t)throw new Error("geojson is required");var e=[];return lt(t,(function(t){!function(t,e){var n=[],r=t.geometry;switch(r.type){case"Polygon":n=U(r);break;case"LineString":n=[U(r)]}n.forEach((function(n){(function(t,e){var n=[];return t.reduce((function(t,r){var i,o,s,a,c,h,u=_([t,r],e);return u.bbox=(o=r,s=(i=t)[0],a=i[1],c=o[0],h=o[1],[s<c?s:c,a<h?a:h,s>c?s:c,a>h?a:h]),n.push(u),r})),n})(n,t.properties).forEach((function(t){t.id=e.length,e.push(t)}))}))}(t,e)})),A(e)}function bt(t,e){var n={},r=[];if("LineString"===t.type&&(t=I(t)),"LineString"===e.type&&(e=I(e)),"Feature"===t.type&&"Feature"===e.type&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var i=wt(t,e);return i&&r.push(i),A(r)}var o=pt();return o.load(vt(e)),ut(vt(t),(function(t){ut(o.search(t),(function(e){var i=wt(t,e);if(i){var o=U(i).join(",");n[o]||(n[o]=!0,r.push(i))}}))})),A(r)}function wt(t,e){var n=U(t),r=U(e);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],o=n[0][1],s=n[1][0],a=n[1][1],c=r[0][0],h=r[0][1],u=r[1][0],l=r[1][1],d=(l-h)*(s-i)-(u-c)*(a-o),p=(u-c)*(o-h)-(l-h)*(i-c),f=(s-i)*(o-h)-(a-o)*(i-c);if(0===d)return null;var g=p/d,y=f/d;return g>=0&&g<=1&&y>=0&&y<=1?R([i+g*(s-i),o+g*(a-o)]):null}function xt(t,e,n){if(!F(n=n||{}))throw new Error("options is invalid");var r=t.geometry?t.geometry.type:t.type;if("LineString"!==r&&"MultiLineString"!==r)throw new Error("lines must be LineString or MultiLineString");var i=R([1/0,1/0],{dist:1/0}),o=0;return lt(t,(function(t){for(var r=U(t),s=0;s<r.length-1;s++){var a=R(r[s]);a.properties.dist=Y(e,a,n);var c=R(r[s+1]);c.properties.dist=Y(e,c,n);var h=Y(a,c,n),u=Math.max(a.properties.dist,c.properties.dist),l=H(a,c),d=V(e,u,l+90,n),p=V(e,u,l-90,n),f=bt(_([d.geometry.coordinates,p.geometry.coordinates]),_([a.geometry.coordinates,c.geometry.coordinates])),g=null;f.features.length>0&&((g=f.features[0]).properties.dist=Y(e,g,n),g.properties.location=o+Y(a,g,n)),a.properties.dist<i.properties.dist&&((i=a).properties.index=s,i.properties.location=o),c.properties.dist<i.properties.dist&&((i=c).properties.index=s+1,i.properties.location=o+h),g&&g.properties.dist<i.properties.dist&&((i=g).properties.index=s),o+=h}})),i}function Et(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var n=G(t),r=G(e);if("LineString"!==n)throw new Error("line must be LineString");if("FeatureCollection"===r)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===r)throw new Error("splitter cannot be a GeometryCollection");var i=mt(e,{precision:7});switch(r){case"Point":return Nt(t,i);case"MultiPoint":return kt(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return kt(t,bt(t,i))}}function kt(t,e){var n=[],r=pt();return lt(e,(function(e){if(n.forEach((function(t,e){t.id=e})),n.length){var i=r.search(e);if(i.features.length){var o=Lt(e,i);n=n.filter((function(t){return t.id!==o.id})),r.remove(o),ut(Nt(o,e),(function(t){n.push(t),r.insert(t)}))}}else(n=Nt(t,e).features).forEach((function(t){t.bbox||(t.bbox=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];if(Y(t.slice(0,2),[r,n])>=Y(t.slice(0,2),[e,i])){var o=(n+i)/2;return[e,o-(r-e)/2,r,o+(r-e)/2]}var s=(e+r)/2;return[s-(i-n)/2,n,s+(i-n)/2,i]}(yt(t)))})),r.load(A(n))})),A(n)}function Nt(t,e){var n=[],r=U(t)[0],i=U(t)[t.geometry.coordinates.length-1];if(Ct(r,q(e))||Ct(i,q(e)))return A([t]);var o=pt(),s=vt(t);o.load(s);var a=o.search(e);if(!a.features.length)return A([t]);var c=Lt(e,a),h=function(t,e,n){var r=n;return ut(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r}(s,(function(t,r,i){var o=U(r)[1],s=q(e);return i===c.id?(t.push(s),n.push(_(t)),Ct(s,o)?[s]:[s,o]):(t.push(o),t)}),[r]);return h.length>1&&n.push(_(h)),A(n)}function Lt(t,e){if(!e.features.length)throw new Error("lines must contain features");if(1===e.features.length)return e.features[0];var n,r=1/0;return ut(e,(function(e){var i=xt(e,t).properties.dist;i<r&&(n=e,r=i)})),n}function Ct(t,e){return t[0]===e[0]&&t[1]===e[1]}function St(t,e){if(!F(e=e||{}))throw new Error("options is invalid");if(!t)throw new Error("geojson is required");return dt(t,(function(t,n){var r=n.geometry.coordinates;return t+Y(r[0],r[1],e)}),0)}function Tt(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return It(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}})),e.features=t.features.map((function(t){return It(t)})),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Rt(t);default:throw new Error("unknown GeoJSON type")}}function It(t){var e={type:"Feature"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}})),e.properties=function t(e){var n={};return e?(Object.keys(e).forEach((function(r){var i=e[r];"object"===C(i)?null===i?n[r]=null:i.length?n[r]=i.map((function(t){return t})):n[r]=t(i):n[r]=i})),n):n}(t.properties),e.geometry=Rt(t.geometry),e}function Rt(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map((function(t){return Rt(t)})),e):(e.coordinates=function t(e){if("object"!==C(e[0]))return e.slice();return e.map((function(e){return t(e)}))}(t.coordinates),e)}Q.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],r=this.toBBox;if(!st(t,e))return n;for(var i,o,s,a,c=[];e;){for(i=0,o=e.children.length;i<o;i++)s=e.children[i],st(t,a=e.leaf?r(s):s)&&(e.leaf?n.push(s):ot(t,a)?this._all(s,n):c.push(s));e=c.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!st(t,e))return!1;for(var r,i,o,s,a=[];e;){for(r=0,i=e.children.length;r<i;r++)if(o=e.children[r],st(t,s=e.leaf?n(o):o)){if(e.leaf||ot(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=at([]),this},remove:function(t,e){if(!t)return this;for(var n,r,i,o,s=this.data,a=this.toBBox(t),c=[],h=[];s||c.length;){if(s||(s=c.pop(),r=c[c.length-1],n=h.pop(),o=!0),s.leaf&&-1!==(i=$(t,s.children,e)))return s.children.splice(i,1),c.push(s),this._condense(c),this;o||s.leaf||!ot(s,a)?r?(n++,s=r.children[n],o=!1):s=null:(c.push(s),h.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:et,compareMinY:nt,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,r){var i,o=n-e+1,s=this._maxEntries;if(o<=s)return K(i=at(t.slice(e,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=at([])).leaf=!1,i.height=r;var a,c,h,u,l=Math.ceil(o/s),d=l*Math.ceil(Math.sqrt(s));for(ct(t,e,n,d,this.compareMinX),a=e;a<=n;a+=d)for(ct(t,a,h=Math.min(a+d-1,n),l,this.compareMinY),c=a;c<=h;c+=l)u=Math.min(c+l-1,h),i.children.push(this._build(t,c,u,r-1));return K(i,this.toBBox),i},_chooseSubtree:function(t,e,n,r){for(var i,o,s,a,c,h,u,l,d,p;r.push(e),!e.leaf&&r.length-1!==n;){for(u=l=1/0,i=0,o=e.children.length;i<o;i++)c=rt(s=e.children[i]),d=t,p=s,(h=(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-c)<l?(l=h,u=c<u?c:u,a=s):h===l&&c<u&&(u=c,a=s);e=a||e.children[0]}return e},_insert:function(t,e,n){var r=this.toBBox,i=n?t:r(t),o=[],s=this._chooseSubtree(i,this.data,e,o);for(s.children.push(t),tt(s,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=at(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,K(n,this.toBBox),K(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=at([t,e]),this.data.height=t.height+1,this.data.leaf=!1,K(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var r,i,o,s,a,c,h,u,l,d,p,f,g,y;for(c=h=1/0,r=e;r<=n-e;r++)i=Z(t,0,r,this.toBBox),o=Z(t,r,n,this.toBBox),l=i,d=o,p=void 0,f=void 0,g=void 0,y=void 0,p=Math.max(l.minX,d.minX),f=Math.max(l.minY,d.minY),g=Math.min(l.maxX,d.maxX),y=Math.min(l.maxY,d.maxY),s=Math.max(0,g-p)*Math.max(0,y-f),a=rt(i)+rt(o),s<c?(c=s,u=r,h=a<h?a:h):s===c&&a<h&&(h=a,u=r);return u},_chooseSplitAxis:function(t,e,n){var r=t.leaf?this.compareMinX:et,i=t.leaf?this.compareMinY:nt;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},_allDistMargin:function(t,e,n,r){t.children.sort(r);var i,o,s=this.toBBox,a=Z(t,0,e,s),c=Z(t,n-e,n,s),h=it(a)+it(c);for(i=e;i<n-e;i++)o=t.children[i],tt(a,t.leaf?s(o):o),h+=it(a);for(i=n-e-1;i>=e;i--)o=t.children[i],tt(c,t.leaf?s(o):o),h+=it(c);return h},_adjustParentBBoxes:function(t,e,n){for(var r=n;r>=0;r--)tt(e[r],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():K(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};class _t{constructor(){this.distance=0,this.duration=0,this.weight=0,this.geometry=null,this.summary="",this.steps=[]}}class At{constructor(){this.distance=0,this.duration=0,this.geometry=null,this.weight=0,this.name="",this.intersections=null,this.mode="driving",this.driving_side="right",this.maneuver=null}}!function(t){t.RIGHT="right",t.SLIGHT_RIGHT="slight right",t.SHARP_RIGHT="sharp right",t.LEFT="left",t.SLIGHT_LEFT="slight left",t.SHARP_LEFT="sharp left",t.STRAIGHT="straight",t.UTURN="uturn"}(S||(S={}));var Pt,Mt=S;function Bt(t,e){return t/e*3.6}function Ot(t,e){return e>=0?t.coordinates[e]:t.coordinates[t.coordinates.length+e]}function Ft(t,e){const n=t.map(t=>Math.round(1e6*t)),r=e.map(t=>Math.round(1e6*t));return Math.abs(n[0]-r[0])<=1&&Math.abs(n[1]-r[1])<=1}function Dt(t){return t<0?t+=360:t>=360&&(t-=360),t}function jt(t,e){const n=t.coordinates[t.coordinates.length-1],r=e.coordinates[0];n[0]===r[0]&&n[1]===r[1]||t.coordinates.push(r);for(let n=0;n<e.coordinates.length;n++)t.coordinates.push(e.coordinates[n]);return t}function qt(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}class Ut{constructor(){this.bearing_before=0,this.bearing_after=0}setModifier(){this.modifier=function(t,e){let n=e-t;return n<0?n+=360:n>=360&&(n-=360),n>120&&n<160?Mt.SHARP_RIGHT:n>40&&n<=120?Mt.RIGHT:n>20&&n<=40?Mt.SLIGHT_RIGHT:n>=0&&n<=20||n>=340&&n<=360?Mt.STRAIGHT:n>320&&n<340?Mt.SLIGHT_LEFT:n>240&&n<=320?Mt.LEFT:n>200&&n<=240?Mt.SHARP_LEFT:Mt.UTURN}(this.bearing_before,this.bearing_after)}}!function(t){t.DEPART="depart",t.ARRIVE="arrive",t.TURN="turn",t.CONTINUE="continue",t.NEW_NAME="new name"}(Pt||(Pt={}));var Gt=Pt;function Ht(t,e,n){const r=new _t,i=[];t.forEach(t=>{r.duration+=t.duration,t.name&&-1===i.findIndex(e=>e===t.name)&&i.push(t.name)}),r.weight=r.duration,r.summary=function(t){if(t.length<=3)return t.join("，");{const e=[];return e.push(t[0]),e.push(t.length/2),e.push(t[t.length-1]),e.join("，")}}(i),r.geometry=function(t){const e=t.length;let n=[];for(let r=0;r<e;r++){t[r].geometry.coordinates.forEach(t=>{n.push(t)})}if(0===n.length)return null;{let t=null;const e=[];n.forEach(n=>{t&&Ft(t,n)||(e.push(n),t=n)}),n=e}return _(n)}(t),r.distance=Math.round(1e3*St(r.geometry));const o=[],s=t.length;for(let e=0;e<s;e++){const n=t[e];if(n.linkType&&"2"===n.linkType){let r=!1;if(o.length>0){const t=o[o.length-1];Math.abs(t.bearingExit-n.bearingEntrance)<=10&&(Yt(t,n,!1),r=!0)}if(!r&&e<s-1){const i=t[e+1];Math.abs(n.bearingExit-i.bearingEntrance)<=10&&(Yt(i,n,!0),r=!0)}!r&&n.distance>30&&o.push(n)}else o.push(n)}let a=0,c=(t=o).map(t=>{const e=new At,n=t.geometry;return e.distance=t.distance,e.duration=t.duration,e.roadId=t.roadId,e.name=t.name,e.maneuver=new Ut,e.maneuver.location=[n.coordinates[0][0],n.coordinates[0][1]],e.maneuver.bearing_before=a,e.maneuver.bearing_after=t.bearingEntrance,e.maneuver.type=Gt.TURN,e.maneuver.setModifier(),e.geometry=n,a=t.bearingExit,e}),h=c[0];const u=[h];for(let t=1;t<c.length;t++){const e=c[t],n=h.roadId===e.roadId||!h.name&&!e.name;n&&"straight"===e.maneuver.modifier?(h.distance+=e.distance,h.duration+=e.duration,h.weight+=e.duration,h.name=h.name||e.name,jt(h.geometry,e.geometry)):(n&&"straight"!==e.maneuver.modifier?e.maneuver.type=Gt.CONTINUE:n||"straight"!==e.maneuver.modifier||(e.maneuver.type=Gt.NEW_NAME),u.push(e),h=e)}c=u,c[0].maneuver.type=Gt.DEPART;const l=t[t.length-1],d=l.geometry.coordinates[l.geometry.coordinates.length-1],p=function(t,e,n,r,i){const o=new At;return o.roadId=t,o.name=e,o.distance=0,o.duration=0,o.weight=0,o.maneuver=new Ut,o.maneuver.location=n,o.maneuver.bearing_before=r,o.maneuver.bearing_after=i,o.maneuver.setModifier(),o.maneuver.type=Gt.ARRIVE,o.geometry={type:"LineString",coordinates:[n,n]},o}(l.roadId,l.name,d,l.bearingExit,Dt(H(d,n)));return c.push(p),r.steps=c,r}function Yt(t,e,n){t.distance+=e.distance,t.duration+=e.duration,n?(t.geometry.coordinates=e.geometry.coordinates.concat(t.geometry.coordinates),t.bearingEntrance=e.bearingEntrance):(t.geometry.coordinates=t.geometry.coordinates.concat(e.geometry.coordinates),t.bearingExit=e.bearingExit)}class Vt{constructor(){this.geometry=null,this.legs=null}}var Xt=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(n,r,i){if("function"!=typeof r)throw new Error("callback is expected to be a function");var o=e[n];return o||(o=e[n]=[]),o.push({callback:r,ctx:i}),t},off:function(n,r){if(void 0===n)return e=Object.create(null),t;if(e[n])if("function"!=typeof r)delete e[n];else for(var i=e[n],o=0;o<i.length;++o)i[o].callback===r&&i.splice(o,1);return t},fire:function(n){var r,i=e[n];if(!i)return t;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var o=0;o<i.length;++o){var s=i[o];s.callback.apply(s.ctx,r)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t};var Jt=function(t){"uniqueLinkId"in(t=t||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),t.multigraph=t.uniqueLinkId);void 0===t.multigraph&&(t.multigraph=!1);var e="function"==typeof Object.create?Object.create(null):{},n=[],r={},i=0,o=0,s=Object.keys?N:L,a=t.multigraph?function(t,e,n){var i=Kt(t,e),o=r.hasOwnProperty(i);if(o||w(t,e)){o||(r[i]=0);var s="@"+ ++r[i];i=Kt(t+s,e+s)}return new $t(t,e,n,i)}:function(t,e,n){var r=Kt(t,e);return new $t(t,e,n,r)},c=[],h=x,u=x,l=x,d=x,p={addNode:y,addLink:function(t,e,r){l();var i=m(t)||y(t),o=m(e)||y(e),s=a(t,e,r);n.push(s),Qt(i,s),t!==e&&Qt(o,s);return h(s,"add"),d(),s},removeLink:b,removeNode:v,getNode:m,getNodesCount:function(){return i},getLinksCount:function(){return n.length},getLinks:function(t){var e=m(t);return e?e.links:null},forEachNode:s,forEachLinkedNode:function(t,n,r){var i=m(t);if(i&&i.links&&"function"==typeof n)return r?function(t,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(o.fromId===n&&r(e[o.toId],o))return!0}}(i.links,t,n):function(t,n,r){for(var i=0;i<t.length;++i){var o=t[i],s=o.fromId===n?o.toId:o.fromId;if(r(e[s],o))return!0}}(i.links,t,n)},forEachLink:function(t){var e,r;if("function"==typeof t)for(e=0,r=n.length;e<r;++e)t(n[e])},beginUpdate:l,endUpdate:d,clear:function(){l(),s((function(t){v(t.id)})),d()},hasLink:w,hasNode:m,getLink:w};return Xt(p),function(){var t=p.on;p.on=function(){return p.beginUpdate=l=E,p.endUpdate=d=k,h=f,u=g,p.on=t,t.apply(p,arguments)}}(),p;function f(t,e){c.push({link:t,changeType:e})}function g(t,e){c.push({node:t,changeType:e})}function y(t,n){if(void 0===t)throw new Error("Invalid node identifier");l();var r=m(t);return r?(r.data=n,u(r,"update")):(r=new zt(t,n),i++,u(r,"add")),e[t]=r,d(),r}function m(t){return e[t]}function v(t){var n=m(t);if(!n)return!1;l();var r=n.links;if(r){n.links=null;for(var o=0;o<r.length;++o)b(r[o])}return delete e[t],i--,u(n,"remove"),d(),!0}function b(t){if(!t)return!1;var e=Wt(t,n);if(e<0)return!1;l(),n.splice(e,1);var r=m(t.fromId),i=m(t.toId);return r&&(e=Wt(t,r.links))>=0&&r.links.splice(e,1),i&&(e=Wt(t,i.links))>=0&&i.links.splice(e,1),h(t,"remove"),d(),!0}function w(t,e){var n,r=m(t);if(!r||!r.links)return null;for(n=0;n<r.links.length;++n){var i=r.links[n];if(i.fromId===t&&i.toId===e)return i}return null}function x(){}function E(){o+=1}function k(){0===(o-=1)&&c.length>0&&(p.fire("changed",c),c.length=0)}function N(t){if("function"==typeof t)for(var n=Object.keys(e),r=0;r<n.length;++r)if(t(e[n[r]]))return!0}function L(t){var n;if("function"==typeof t)for(n in e)if(t(e[n]))return!0}};function Wt(t,e){if(!e)return-1;if(e.indexOf)return e.indexOf(t);var n,r=e.length;for(n=0;n<r;n+=1)if(e[n]===t)return n;return-1}function zt(t,e){this.id=t,this.links=null,this.data=e}function Qt(t,e){t.links?t.links.push(e):t.links=[e]}function $t(t,e,n,r){this.fromId=t,this.toId=e,this.data=n,this.id=r}function Kt(t,e){return t.toString()+"👉 "+e.toString()}class Zt{constructor(t,e){this.nodeData=t,this.edgeData=e,this.init()}init(){this.graph=Jt();for(const t in this.nodeData)this.nodeData[t].forEach(t=>{this.graph.addNode(t.id,t)});this.edgeData.forEach(t=>{this.graph.addLink(t.fromNodeId,t.toNodeId,t)})}getGraph(){return this.graph}}function te(t,e,n={}){let r=R([1/0,1/0],{dist:1/0}),i=0;return lt(t,(function(t){const o=U(t);for(let t=0;t<o.length-1;t++){const s=R(o[t]);s.properties.dist=Y(e,s,n);const a=R(o[t+1]);a.properties.dist=Y(e,a,n);const c=Y(s,a,n),h=Math.max(s.properties.dist,a.properties.dist),u=H(s,a),l=V(e,h,u+90,n),d=V(e,h,u-90,n),p=bt(_([l.geometry.coordinates,d.geometry.coordinates]),_([s.geometry.coordinates,a.geometry.coordinates]));let f=null;p.features.length>0&&(f=p.features[0],f.properties.dist=Y(e,f,n),f.properties.location=i+Y(s,f,n)),s.properties.dist<r.properties.dist&&ee(e,u)&&(r=s,r.properties.index=t,r.properties.location=i,r.properties.direction=u),a.properties.dist<r.properties.dist&&ee(e,u)&&(r=a,r.properties.index=t,r.properties.location=i+c,r.properties.direction=u),f&&f.properties.dist<r.properties.dist&&ee(e,u)&&(r=f,r.properties.index=t,r.properties.direction=u),i+=c}})),r}function ee(t,e){const n=t;return!n.properties||null===n.properties.direction||void 0===n.properties.direction||function(t,e){let n,r;n=t-e,r=360-Math.abs(n),n>0&&(r*=-1);const i=Math.abs(n),o=Math.abs(r);return i<o?i:o}(n.properties.direction,e)<90}function ne(t,e,n,r){if(!(this instanceof ne))return new ne(t,e,n,r);var i,o,s;t.x?(n=t.w,r=t.h,e=t.y,0!==t.w&&!t.w&&t.x2?(n=t.x2-t.x,r=t.y2-t.y):(n=t.w,r=t.h),t=t.x,i=t+n,o=e+r,s=!(r+n)):(i=t+n,o=e+r,s=!(r+n)),this.x1=this.x=function(){return t},this.y1=this.y=function(){return e},this.x2=function(){return i},this.y2=function(){return o},this.w=function(){return n},this.h=function(){return r},this.p=function(){return s},this.overlap=function(n){return s||n.p()?t<=n.x2()&&i>=n.x()&&e<=n.y2()&&o>=n.y():t<n.x2()&&i>n.x()&&e<n.y2()&&o>n.y()},this.expand=function(s){var a,c,h=s.x(),u=s.y(),l=s.x2(),d=s.y2();return a=t>h?h:t,c=e>u?u:e,n=i>l?i-a:l-a,r=o>d?o-c:d-c,t=a,e=c,this}}ne.overlapRectangle=function(t,e){return 0===t.h&&0===t.w||0===e.h&&0===e.w?t.x<=e.x+e.w&&t.x+t.w>=e.x&&t.y<=e.y+e.h&&t.y+t.h>=e.y:t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y},ne.containsRectangle=function(t,e){return t.x+t.w<=e.x+e.w&&t.x>=e.x&&t.y+t.h<=e.y+e.h&&t.y>=e.y},ne.expandRectangle=function(t,e){var n,r,i=t.x+t.w,o=e.x+e.w,s=t.y+t.h,a=e.y+e.h;return n=t.x>e.x?e.x:t.x,r=t.y>e.y?e.y:t.y,t.w=i>o?i-n:o-n,t.h=s>a?s-r:a-r,t.x=n,t.y=r,t},ne.makeMBR=function(t,e){if(!t.length)return{x:0,y:0,w:0,h:0};(e=e||{}).x=t[0].x,e.y=t[0].y,e.w=t[0].w,e.h=t[0].h;for(var n=1,r=t.length;n<r;n++)ne.expandRectangle(e,t[n]);return e},ne.squarifiedRatio=function(t,e,n){var r=(t+e)/2,i=t*e;return i*n/(i/(r*r))};var re=ne;function ie(t){if(!(this instanceof ie))return new ie(t);var e=3,n=6;isNaN(t)||(e=Math.floor(t/2),n=t);var r={x:0,y:0,w:0,h:0,id:"root",nodes:[]};this.root=r;var i=function(t){for(var e,n=t.slice(),r=[];n.length;)(e=n.pop()).nodes?n=n.concat(e.nodes):e.leaf&&r.push(e);return r},o=function(t,n,r){var o,s,a,c=[],l=[],d=[];if(!t||!re.overlapRectangle(t,r))return d;var p={x:t.x,y:t.y,w:t.w,h:t.h,target:n};for(l.push(r.nodes.length),c.push(r);c.length>0;)if(o=c.pop(),s=l.pop()-1,"target"in p)for(;s>=0;){if(a=o.nodes[s],re.overlapRectangle(p,a)){if(p.target&&"leaf"in a&&a.leaf===p.target||!p.target&&("leaf"in a||re.containsRectangle(a,p))){d="nodes"in a?i(o.nodes.splice(s,1)):o.nodes.splice(s,1),re.makeMBR(o.nodes,o),delete p.target;break}"nodes"in a&&(l.push(s),c.push(o),o=a,s=a.nodes.length)}s--}else if("nodes"in p){o.nodes.splice(s+1,1),o.nodes.length>0&&re.makeMBR(o.nodes,o);for(var f=0;f<p.nodes.length;f++)u(p.nodes[f],o);p.nodes=[],0===c.length&&o.nodes.length<=1?(p.nodes=h(o,!0,p.nodes,o),o.nodes=[],c.push(o),l.push(1)):c.length>0&&o.nodes.length<e?(p.nodes=h(o,!0,p.nodes,o),o.nodes=[]):delete p.nodes}else re.makeMBR(o.nodes,o);return d},s=function(t){for(var e=c(t);t.length>0;)a(t,e[0],e[1]);return e},a=function(t,n,r){for(var i,o,s,a=re.squarifiedRatio(n.w,n.h,n.nodes.length+1),c=re.squarifiedRatio(r.w,r.h,r.nodes.length+1),h=t.length-1;h>=0;h--){var u=t[h],l={};l.x=Math.min(n.x,u.x),l.y=Math.min(n.y,u.y),l.w=Math.max(n.x+n.w,u.x+u.w)-l.x,l.h=Math.max(n.y+n.h,u.y+u.h)-l.y;var d=Math.abs(re.squarifiedRatio(l.w,l.h,n.nodes.length+2)-a),p={};p.x=Math.min(r.x,u.x),p.y=Math.min(r.y,u.y),p.w=Math.max(r.x+r.w,u.x+u.w)-p.x,p.h=Math.max(r.y+r.h,u.y+u.h)-p.y;var f=Math.abs(re.squarifiedRatio(p.w,p.h,r.nodes.length+2)-c);(!o||!i||Math.abs(f-d)<i)&&(o=h,i=Math.abs(f-d),s=f<d?r:n)}var g=t.splice(o,1)[0];n.nodes.length+t.length+1<=e?(n.nodes.push(g),re.expandRectangle(n,g)):r.nodes.length+t.length+1<=e?(r.nodes.push(g),re.expandRectangle(r,g)):(s.nodes.push(g),re.expandRectangle(s,g))},c=function(t){for(var e,n,r=t.length-1,i=0,o=t.length-1,s=0,a=t.length-2;a>=0;a--){var c=t[a];c.x>t[i].x?i=a:c.x+c.w<t[r].x+t[r].w&&(r=a),c.y>t[s].y?s=a:c.y+c.h<t[o].y+t[o].h&&(o=a)}return Math.abs(t[r].x+t[r].w-t[i].x)>Math.abs(t[o].y+t[o].h-t[s].y)?r>i?(e=t.splice(r,1)[0],n=t.splice(i,1)[0]):(n=t.splice(i,1)[0],e=t.splice(r,1)[0]):o>s?(e=t.splice(o,1)[0],n=t.splice(s,1)[0]):(n=t.splice(s,1)[0],e=t.splice(o,1)[0]),[{x:e.x,y:e.y,w:e.w,h:e.h,nodes:[e]},{x:n.x,y:n.y,w:n.w,h:n.h,nodes:[n]}]},h=function(t,e,n,r){var i=[];if(!re.overlapRectangle(t,r))return n;for(i.push(r.nodes);i.length>0;)for(var o=i.pop(),s=o.length-1;s>=0;s--){var a=o[s];re.overlapRectangle(t,a)&&("nodes"in a?i.push(a.nodes):"leaf"in a&&(e?n.push(a):n.push(a.leaf)))}return n},u=function(t,e){var r;if(0===e.nodes.length)return e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,void e.nodes.push(t);for(var i,o=function(t,e){var n,r=-1,i=[],o=!0;i.push(e);for(var s=e.nodes;o||-1!==r;){o?o=!1:(i.push(s[r]),s=s[r].nodes,r=-1);for(var a=s.length-1;a>=0;a--){var c=s[a];if("leaf"in c){r=-1;break}var h=re.squarifiedRatio(c.w,c.h,c.nodes.length+1),u=Math.max(c.x+c.w,t.x+t.w)-Math.min(c.x,t.x),l=Math.max(c.y+c.h,t.y+t.h)-Math.min(c.y,t.y),d=re.squarifiedRatio(u,l,c.nodes.length+2);(r<0||Math.abs(d-h)<n)&&(n=Math.abs(d-h),r=a)}}return i}(t,e),a=t;o.length>0;){if(r&&"nodes"in r&&0===r.nodes.length){i=r,r=o.pop();for(var c=0;c<r.nodes.length;c++)if(r.nodes[c]===i||0===r.nodes[c].nodes.length){r.nodes.splice(c,1);break}}else r=o.pop();if("leaf"in a||"nodes"in a||Array.isArray(a)){if(Array.isArray(a)){for(var h=0;h<a.length;h++)re.expandRectangle(r,a[h]);r.nodes=r.nodes.concat(a)}else re.expandRectangle(r,a),r.nodes.push(a);if(r.nodes.length<=n)a={x:r.x,y:r.y,w:r.w,h:r.h};else{var u=s(r.nodes);a=u,o.length<1&&(r.nodes.push(u[0]),o.push(r),a=u[1])}}else re.expandRectangle(r,a),a={x:r.x,y:r.y,w:r.w,h:r.h}}};this.insertSubtree=u,this.getTree=function(){return r},this.setTree=function(t,e){return e||(e=r),i=t,(n=e).nodes=i.nodes,n.x=i.x,n.y=i.y,n.w=i.w,n.h=i.h,n;var n,i},this.search=function(t,e,n){return h(t,e,n=n||[],r)};this.remove=function(t,e){return e&&"function"!=typeof e?function(t,e){return o(t,e,r)}(t,e):function(t){for(var e,n=1,i=[];n>0;)n=(e=o(t,!1,r)).length,i=i.concat(e);return i}(t)},this.insert=function(t,e){return u({x:t.x,y:t.y,w:t.w,h:t.h,leaf:e},r)}}ie.prototype.toJSON=function(t){return JSON.stringify(this.root,!1,t)},ie.fromJSON=function(t){var e=new ie;return e.setTree(JSON.parse(t)),e};var oe=ie;"function"!=typeof Array.isArray&&(Array.isArray=function(t){return"object"===C(t)&&"[object Array]"==={}.toString.call(t)});class se{constructor(t){this.defaultMaxDistance=100,this.edgeRTree=oe(10);for(const e in t)t[e].forEach(t=>{const e=yt(t.geometry),n={x:e[0],y:e[1],w:e[2]-e[0],h:e[3]-e[1]};this.edgeRTree.insert(n,t)})}search(t,e,n){null==n&&(n=this.defaultMaxDistance),n<0&&(n=0);const r=this.getBBox(t,n),i={x:r[0],y:r[1],w:r[2]-r[0],h:r[3]-r[1]},o=this.edgeRTree.search(i);return o&&0!==o.length?this.nearestLine(o,t,e):null}getBBox(t,e){const n=function(t,e){return M(P(t,e))}(e,"metres");return[t[0]-n,t[1]-n,t[0]+n,t[1]+n]}nearestLine(t,e,n){let r=Number.POSITIVE_INFINITY;const i=t.map(t=>{const n=this.getNearestPoint(e,t.geometry);return n.properties.distanceLevel<r&&(r=n.properties.distanceLevel),{nearestPoint:n,nodeData:t}}).filter(t=>t.nearestPoint.properties.distanceLevel===r);return i.length>1&&null!=n?[this.getDirectionNearestNode(i,n)]:i}getNearestPoint(t,e){const n=te(e,t);return n.properties.distanceLevel=Math.floor(1e4*n.properties.dist),n.properties.directionLevel=20*Math.floor(n.properties.direction/20),n}getDirectionNearestNode(t,e){let n=Number.POSITIVE_INFINITY,r=-1;return t.forEach((t,i)=>{let o=Math.abs(t.nearestPoint.properties.direction-e);o%=360,o>180&&(o=360-o),o<n&&(n=o,r=i)}),t[r]}}class ae{constructor(){this.nearestLineSearchRadius=[50]}}function ce(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function he(t,e,n){if(n&&n[t]){const r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}class ue{constructor(t,e={}){qt(this,e),this.type=t}}class le extends ue{constructor(t,e={}){super("error",qt({error:t},e))}}class de{constructor(t,e,n,r,i,o,s,a,c){this.noEntry=!1,this.isFromNode=!1,this.isToNode=!1,this.isContainerRoad=!1,this.id=n+"_"+r,this.roadId=t,this.name=e,this.fromNodeId=n,this.toNodeId=r,this.geometry=i,this.distance=o,this.speed=s,this.linkType=a,this.duration=Math.round(Bt(this.distance,this.speed)),this.bearingEntrance=Math.round(Dt(H(Ot(this.geometry,0),Ot(this.geometry,1)))),this.bearingExit=Math.round(Dt(H(Ot(this.geometry,-2),Ot(this.geometry,-1)))),this.isContainerRoad="1"===c||1===c}}class pe{constructor(t){this.nodeDataMap={},t.features.forEach(t=>{const e=pe.getValue(t.properties,"from_node_id",!1),n=pe.getValue(t.properties,"to_node_id",!1),r=pe.getValue(t.properties,"is_container_road",!0),i=pe.getValue(t.properties,"functional_class",!1),o=pe.getValue(t.properties,"traffic_direction",!1),s=pe.getValue(t.properties,"way_form",!1),a=pe.getValue(t.properties,"national_class",!1),c=pe.getValue(t.properties,"lanes_number",!1),h=pe.getValue(t.properties,"road_width",!1),u=pe.getValue(t.properties,"divider",!1),l=pe.getValue(t.properties,"road_surface",!1),d=pe.getValue(t.properties,"height_restriction",!1),p=pe.getValue(t.properties,"weight_restriction",!1),f=pe.getValue(t.properties,"close_traffic_period",!1),g=pe.getValue(t.properties,"traffic_capacity",!1),y={};if(g&&String(g).split(",").forEach(t=>{y[t]=!0}),"0"===o){const g=new de(t.properties.road_id,t.properties.name,e,n,t.geometry,Number(t.properties.length),pe.getSpeed(t.properties),t.properties.link_type,r);g.functionalClass=i,g.trafficDirection=o,g.wayForm=s,g.nationalClass=a,g.lanesNumber=c,g.roadWidth=h,g.divider=u,g.roadSurface=l,g.heightRestriction=d,g.weightRestriction=p,g.closeTrafficPeriod=f,g.trafficCapacity=y,this.addNode(g);const m=new de(t.properties.road_id,t.properties.name,n,e,function(t){if("LineString"!==t.type)throw new Error("The geometry type("+t.type+") is error, must be LineString");const e={type:"LineString",coordinates:[]};for(let n=t.coordinates.length-1;n>=0;n--)e.coordinates.push(t.coordinates[n]);return e}(t.geometry),Number(t.properties.length),pe.getSpeed(t.properties,!0),t.properties.link_type,r);m.functionalClass=i,m.trafficDirection=o,m.wayForm=s,m.nationalClass=a,m.lanesNumber=c,m.roadWidth=h,m.divider=u,m.roadSurface=l,m.heightRestriction=d,m.weightRestriction=p,m.closeTrafficPeriod=f,m.trafficCapacity=y,this.addNode(m)}else if("1"===o){const g=new de(t.properties.road_id,t.properties.name,e,n,t.geometry,Number(t.properties.length),pe.getSpeed(t.properties),t.properties.link_type,r);g.functionalClass=i,g.trafficDirection=o,g.wayForm=s,g.nationalClass=a,g.lanesNumber=c,g.roadWidth=h,g.divider=u,g.roadSurface=l,g.heightRestriction=d,g.weightRestriction=p,g.closeTrafficPeriod=f,g.trafficCapacity=y,this.addNode(g)}else console.log(t.properties.id+"道路禁行")})}static getValue(t,e,n){let r;return t.hasOwnProperty(e)?r=t[e]:e.length>10&&t.hasOwnProperty(e.substring(0,10))&&(r=t[e.substring(0,10)]),n&&null!=r?Number(r):r}addNode(t){this.nodeDataMap[t.fromNodeId]||(this.nodeDataMap[t.fromNodeId]=[]),this.nodeDataMap[t.fromNodeId].push(t)}static getSpeed(t,e=!1){const n=pe.getValue(t,"functional_class",!1);let r;if("0"===n)r=100;else if("1"===n)r=80;else if("2"===n)r=60;else if("3"===n)r=45;else if("4"===n)r=30;else{if("5"!==n)throw new Error(`functional_class=${n}未知`);r=10}const i=pe.getValue(t,"reverse_max_speed",!1),o=Number(e&&i||t.max_speed);return 0===o?r:Math.min(o,r)}get(){return this.nodeDataMap}}class fe{constructor(t,e,n,r){this.fromNodeId=t,this.toNodeId=e,this.bearingBefore=n,this.bearingAfter=r}}class ge{constructor(t){this.linkDataArray=[];for(const e in t){t[e].forEach(e=>{const n=e.id,r=t[e.toNodeId];if(r)if(1===r.length){const t=r[0],i=t.id,o=new fe(n,i,e.bearingExit,t.bearingEntrance);this.addEdge(o)}else r.forEach(t=>{if(!this.isEqualsNode(e,t)){const r=t.id,i=new fe(n,r,e.bearingExit,t.bearingEntrance);this.addEdge(i)}});else;})}}addEdge(t){this.linkDataArray.push(t)}isEqualsNode(t,e){return t.fromNodeId===e.toNodeId&&t.toNodeId===e.fromNodeId}get(){return this.linkDataArray}}const ye=function(t,e,n=!1){if(!t||!e||"object"!=typeof t||"object"!=typeof e)return t;const r=Object.assign({},t);for(const i in e)e.hasOwnProperty(i)&&(e[i]instanceof Array&&t[i]instanceof Array?r[i]=n?[...t[i],...e[i]]:e[i]:"object"==typeof e[i]&&"object"==typeof t[i]?r[i]=ye(t[i],e[i],n):r[i]=e[i]);return r},me={defaults:{},errorType:null,polyfills:{fetch:null,FormData:null,URLSearchParams:null,performance:null,PerformanceObserver:null,AbortController:null},polyfill(t,{doThrow:e=!0,instance:n=!1}={},...r){const i=this.polyfills[t]||("undefined"!=typeof self?self[t]:null)||("undefined"!=typeof global?global[t]:null);if(e&&!i)throw new Error(t+" is not defined");return n&&i?new i(...r):i}},ve=(t,e,n,r)=>{if(!t.getEntriesByName)return!1;const i=t.getEntriesByName(e);return!!(i&&i.length>0)&&(n(i.reverse()[0]),r.clearMeasures&&r.clearMeasures(e),be.callbacks.delete(e),be.callbacks.size<1&&(be.observer.disconnect(),r.clearResourceTimings&&r.clearResourceTimings()),!0)},be={callbacks:new Map,observer:null,observe:(t,e)=>{if(!t||!e)return;const n=me.polyfill("performance",{doThrow:!1});((t,e)=>(!be.observer&&t&&e&&(be.observer=new e(e=>{be.callbacks.forEach((n,r)=>{ve(e,r,n,t)})}),t.clearResourceTimings&&t.clearResourceTimings()),be.observer))(n,me.polyfill("PerformanceObserver",{doThrow:!1}))&&(ve(n,t,e,n)||(be.callbacks.size<1&&be.observer.observe({entryTypes:["resource","measure"]}),be.callbacks.set(t,e)))}};class we{constructor(t){this.error=t}}class xe{constructor(t,e,n=new Map,r=[],i=[],o=[]){this._url=t,this._options=e,this._catchers=n,this._resolvers=r,this._middlewares=i,this._deferredChain=o}static factory(t="",e={}){return new xe(t,e)}selfFactory({url:t=this._url,options:e=this._options,catchers:n=this._catchers,resolvers:r=this._resolvers,middlewares:i=this._middlewares,deferredChain:o=this._deferredChain}={}){return new xe(t,Object.assign({},e),new Map(n),[...r],[...i],[...o])}defaults(t,e=!1){return me.defaults=e?ye(me.defaults,t):t,this}errorType(t){return me.errorType=t,this}polyfills(t){return me.polyfills=Object.assign(Object.assign({},me.polyfills),t),this}url(t,e=!1){if(e)return this.selfFactory({url:t});const n=this._url.split("?");return this.selfFactory({url:n.length>1?n[0]+t+"?"+n[1]:this._url+t})}options(t,e=!0){return this.selfFactory({options:e?ye(this._options,t):t})}query(t,e=!1){return this.selfFactory({url:Ee(this._url,t,e)})}headers(t){return this.selfFactory({options:ye(this._options,{headers:t||{}})})}accept(t){return this.headers({Accept:t})}content(t){return this.headers({"Content-Type":t})}auth(t){return this.headers({Authorization:t})}catcher(t,e){const n=new Map(this._catchers);return n.set(t,e),this.selfFactory({catchers:n})}signal(t){return this.selfFactory({options:Object.assign(Object.assign({},this._options),{signal:t.signal})})}resolve(t,e=!1){return this.selfFactory({resolvers:e?[t]:[...this._resolvers,t]})}defer(t,e=!1){return this.selfFactory({deferredChain:e?[t]:[...this._deferredChain,t]})}middlewares(t,e=!1){return this.selfFactory({middlewares:e?t:[...this._middlewares,...t]})}method(t,e={},n=null){let r=n?"object"==typeof n?this.json(n):this.body(n):this;return r=r.options(Object.assign(Object.assign({},e),{method:t})),(t=>{const{_url:e,_catchers:n,_resolvers:r,_middlewares:i,_options:o}=t,s=new Map(n),a=ye(me.defaults,o),c=me.polyfill("AbortController",{doThrow:!1,instance:!0});!a.signal&&c&&(a.signal=c.signal);const h={ref:null,clear(){h.ref&&(clearTimeout(h.ref),h.ref=null)}},u=(t=>e=>0===t.length?e:1===t.length?t[0](e):t.reduceRight((n,r,i)=>i===t.length-2?r(n(e)):r(n)))(i)(me.polyfill("fetch"))(e,a),l=u.catch(t=>{throw new we(t)}).then(t=>(h.clear(),t.ok?t:t[me.errorType||"text"]().then(e=>{const n=new Error(e);throw n[me.errorType||"text"]=e,n.status=t.status,n.response=t,n}))),d=e=>e.catch(e=>{h.clear();const n=e instanceof we?e.error:e;if(e instanceof we&&s.has("__fromFetch"))return s.get("__fromFetch")(n,t);if(s.has(n.status))return s.get(n.status)(n,t);if(s.has(n.name))return s.get(n.name)(n,t);throw n}),p=t=>e=>d(t?l.then(e=>e&&e[t]()).then(t=>e?e(t):t):l.then(t=>e?e(t):t)),f={res:p(null),json:p("json"),blob:p("blob"),formData:p("formData"),arrayBuffer:p("arrayBuffer"),text:p("text"),perfs:t=>(u.then(e=>be.observe(e.url,t)),f),setTimeout:(t,e=c)=>(h.clear(),h.ref=setTimeout(()=>e.abort(),t),f),controller:()=>[c,f],error:(t,e)=>(s.set(t,e),f),badRequest:t=>f.error(400,t),unauthorized:t=>f.error(401,t),forbidden:t=>f.error(403,t),notFound:t=>f.error(404,t),timeout:t=>f.error(408,t),internalError:t=>f.error(500,t),fetchError:t=>f.error("__fromFetch",t),onAbort:t=>f.error("AbortError",t)};return r.reduce((e,n)=>n(e,t),f)})(r._deferredChain.reduce((t,e)=>e(t,t._url,t._options),r))}get(t){return this.method("GET",t)}delete(t){return this.method("DELETE",t)}put(t,e){return this.method("PUT",e,t)}post(t,e){return this.method("POST",e,t)}patch(t,e){return this.method("PATCH",e,t)}head(t){return this.method("HEAD",t)}opts(t){return this.method("OPTIONS",t)}replay(t){return this.method(this._options.method,t)}body(t){return this.selfFactory({options:Object.assign(Object.assign({},this._options),{body:t})})}json(t){return this.content("application/json").body(JSON.stringify(t))}formData(t,e=!1){return this.body(function t(e,n=!1,r=me.polyfill("FormData",{instance:!0}),i=[]){return Object.entries(e).forEach(([e,o])=>{let s=i.reduce((t,e)=>t?`${t}[${e}]`:e,null);if(s=s?`${s}[${e}]`:e,o instanceof Array)for(const t of o)r.append(s+"[]",t);else!n||"object"!=typeof o||n instanceof Array&&n.includes(e)?r.append(s,o):null!==o&&t(o,n,r,[...i,e])}),r}(t,e))}formUrl(t){return this.body("string"==typeof t?t:(e=t,Object.keys(e).map(t=>{const n=e[t];return n instanceof Array?n.map(e=>ke(t,e)).join("&"):ke(t,n)}).join("&"))).content("application/x-www-form-urlencoded");var e}}const Ee=(t,e,n)=>{let r;if("string"==typeof e)r=e;else{const t=me.polyfill("URLSearchParams",{instance:!0});for(const n in e)if(e[n]instanceof Array)for(const r of e[n])t.append(n,r);else t.append(n,e[n]);r=t.toString()}const i=t.split("?");return n||i.length<2?i[0]+"?"+r:t+"&"+r};function ke(t,e){return encodeURIComponent(t)+"="+encodeURIComponent("object"==typeof e?JSON.stringify(e):""+e)}class Ne extends class{on(t,e){return this._listeners=this._listeners||{},ce(t,e,this._listeners),this}off(t,e){return he(t,e,this._listeners),he(t,e,this._oneTimeListeners),this}once(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},ce(t,e,this._oneTimeListeners),this}fire(t,e){"string"==typeof t&&(t=new ue(t,e||{}));const n=t.type;if(this.listens(n)){t.target=this;const e=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of e)n.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const e of r)he(n,e,this._oneTimeListeners),e.call(this,t);const i=this._eventedParent;i&&(qt(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(t))}else t instanceof le&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}{constructor(t){if(super(),this.options=Object.assign(new ae,t),!this.options.roadGeojson){const t=new Error("[PathFinder] the roadGeojson option is required, for examples: \n const pathFinder  = new smartnavx.PathFinder({\n        roadGeojson: 'http://localhost:8080/road.geojson'\n    });");console.log(t.message),this.fire(new le(t))}this.options.trafficProfile&&!Array.isArray(this.options.trafficProfile)&&(this.options.trafficProfile=String(this.options.trafficProfile).split(",")),this.loadRoad()}loadRoad(){"string"==typeof this.options.roadGeojson?xe.factory(this.options.roadGeojson).get().json(t=>{this.initByRoadGeojson(t)}).catch(t=>{this.fire(new le(t))}):setTimeout(()=>{this.initByRoadGeojson(this.options.roadGeojson)})}initByRoadGeojson(t){const e=new pe(t).get(),n=new ge(e).get();this.roadGraph=new Zt(e,n),this.graph=this.roadGraph.getGraph(),this.nearestLine=new se(e);const r=function(t){if(t.data.trafficCapacity&&this.options.trafficProfile){const e=t.data;return-1!==this.options.trafficProfile.findIndex(t=>e.trafficCapacity[t])}return!0}.bind(this),i=function(t,e,n){if(!r(t))return Number.POSITIVE_INFINITY;if(this.options.nodeFilter&&!this.options.nodeFilter(t,n))return Number.POSITIVE_INFINITY;if(t.data.noEntry)return Number.POSITIVE_INFINITY;let i=0;return e.data.isFromNode&&(i=e.data.distance),!t.data.isToNode&&t.data.isContainerRoad?i+100*t.data.distance:i+Ne.getDistance(t)}.bind(this),o=function(t,e){const n=t.data.geometry.coordinates,r=e.data.geometry.coordinates;return 1e3*Y(n[n.length-1],r[0])}.bind(this);this.pathFinder=L(this.graph,{oriented:!0,distance:i.bind(this),heuristic:o.bind(this)});const s=new ue("load",{source:this});this.fire(s)}static getDistance(t){return"0"==t.data.functionalClass?.3*t.data.distance:"1"==t.data.functionalClass?.45*t.data.distance:"2"==t.data.functionalClass?.6*t.data.distance:"3"==t.data.functionalClass?t.data.distance:"4"==t.data.functionalClass?2*t.data.distance:"5"==t.data.functionalClass?10*t.data.distance:t.data.distance}findByNode(t,e){const n=[];try{t.data.isFromNode=!0,e.data.isToNode=!0;let r=this.pathFinder.find(t.id,e.id);if((!r||r.length<2)&&(r=null),r&&r.length>1&&this.pathFilterRuler){let i=this.pathFilterRuler.getContainedRules(r);for(;i.length>0;)i.forEach(t=>{t.forbiddenNodes.forEach(t=>{const e=this.graph.getNode(t);if(e){const t=e.data;t.noEntry=!0,n.push(t),"2"!==t.linkType&&console.log("nodeData.linkType is not 2")}})}),r=this.pathFinder.find(t.id,e.id),i=this.pathFilterRuler.getContainedRules(r)}return r}finally{delete t.data.isFromNode,delete e.data.isToNode,n.forEach(t=>{delete t.noEntry})}}find(t,e,n){const r=this.pointToNodes(t);if(!r||0===r.length)return n&&n(new Error("起点附近未查询到道路"),null);const i=this.pointToNodes(e);if(!i||0===i.length)return n&&n(new Error("终点附近未查询到道路"),null);this.getLngLat(t);const o=this.getLngLat(e),s=[];for(const t of r){const e=t.nodeData;for(const n of i){const r=n.nodeData;if(e.id!==r.id||t.nearestPoint.properties.location>n.nearestPoint.properties.location){let e,r;try{e=this.addTempFromNode(t),r=this.addTempToNode(n);const i=this.findByNode(e,r);i&&i.length>0&&s.push(Ht(this.getFindResult(i),0,o))}finally{e&&this.graph.removeNode(e.id),r&&this.graph.removeNode(r.id)}}else{const r=X(e.geometry,t.nearestPoint.properties.location,n.nearestPoint.properties.location),i=JSON.parse(JSON.stringify(e));i.distance=1e3*St(r);const a=i.speed?i.speed:50;i.duration=Bt(i.distance,a),i.geometry=r.geometry;const c=[{id:i.id,data:i}];s.push(Ht(this.getFindResult(c),0,o))}}}if(s.length>0){s.sort((t,e)=>t.distance-e.distance);const t=new Vt;t.distance=s[0].distance,t.duration=s[0].duration,t.weight=s[0].weight,t.legs=[s[0]],s.length>2&&t.legs.push(s[2]),n&&n(null,t)}else n&&n(new Error("路径计算不成功"))}forEachLinkedFromNode(t,e){this.graph.forEachLinkedNode(t,e,!0)}forEachLinkedToNode(t,e){this.graph.forEachLinkedNode(t,(function(n,r){String(r.toId)===String(t)&&e(n,r)}),!1)}addTempFromNode(t){const e=t.nodeData,n={id:e.id+"_temp_from_node",data:JSON.parse(JSON.stringify(e))},r=e.geometry.coordinates[e.geometry.coordinates.length-1];if(Ft(t.nearestPoint.geometry.coordinates,e.geometry.coordinates[0]));else if(Ft(t.nearestPoint.geometry.coordinates,r))n.data.distance=0,n.data.duration=0,n.data.geometry=_([[r[0],r[1]],[r[0],r[1]]]).geometry;else{const r=Et(_(e.geometry.coordinates),t.nearestPoint).features[1];n.data.distance=1e3*St(r);const i=n.data.speed?n.data.speed:50;n.data.duration=Bt(n.data.distance,i),n.data.geometry=r.geometry}return this.graph.addNode(n.id,n.data),this.forEachLinkedFromNode(e.id,(t,e)=>{const r=JSON.parse(JSON.stringify(e.data));r.fromNodeId=n.id,r.distance=n.data.distance+t.data.distance,r.duration=n.data.duration+t.data.duration,r.weight=r.duration,this.graph.addLink(n.id,t.id,r)}),n}addTempToNode(t){const e=t.nodeData,n={id:e.id+"_temp_to_node",data:JSON.parse(JSON.stringify(e))},r=e.geometry.coordinates[0],i=e.geometry.coordinates[e.geometry.coordinates.length-1];if(Ft(t.nearestPoint.geometry.coordinates,r))n.data.distance=0,n.data.duration=0,n.data.geometry=_([[r[0],r[1]],[r[0],r[1]]]).geometry;else if(Ft(t.nearestPoint.geometry.coordinates,i));else{const r=Et(_(e.geometry.coordinates),t.nearestPoint).features[0];n.data.distance=1e3*St(r);const i=n.data.speed?n.data.speed:50;n.data.duration=Bt(n.data.distance,i),n.data.geometry=r.geometry}return this.graph.addNode(n.id,n.data),this.forEachLinkedToNode(e.id,(t,e)=>{const r=JSON.parse(JSON.stringify(e.data));r.toNodeId=n.id,r.distance=n.data.distance+t.data.distance,r.duration=n.data.duration+t.data.duration,r.weight=r.duration,this.graph.addLink(t.id,n.id,r)}),n}findRoad(t){const e=this.pointToNodes(t);if(e&&e.length>0){const t=e[0];return{distance:1e3*t.nearestPoint.properties.dist,direction:t.nearestPoint.properties.direction,node:JSON.parse(JSON.stringify(t.nodeData))}}return null}getLngLat(t){return t.longitude?[t.longitude,t.latitude]:t}getFindResult(t){const e=t.map(t=>t.data).reverse();return JSON.parse(JSON.stringify(e))}getNearestLine(){return this.nearestLine}pointToNodes(t){let e,n;t.longitude?(n=[t.longitude,t.latitude],e=t.heading):n=t;const r=this.options.nearestLineSearchRadius;for(let t=0;t<r.length;t++){const i=this.nearestLine.search(n,e,r[t]);if(i)return i}return null}}var Le;!function(t){t.turn="turn"}(Le||(Le={}));var Ce,Se=Le;class Te extends class{}{}class Ie extends Te{constructor(){super(),this.type=Se.turn}}class Re extends Te{constructor(){super(),this.handled=!1,this.type=Se.turn}}function _e(t,e,n={}){const r=function(t){if(!t)throw new Error("geojson is required");if(void 0!==t.geometry)return t.geometry;if(t.coordinates||t.geometries)return t;throw new Error("geojson must be a valid Feature or Geometry Object")}(t).coordinates;let i=0;for(let t=0;t<r.length&&!(e>=i&&t===r.length-1);t++){if(i>=e){const o=e-i;if(o){const e=H(r[t],r[t-1])-180,i=V(r[t],o,e,n);return i.properties.heading=Dt(e),i}return R(r[t])}i+=Y(r[t],r[t+1],n)}return R(r[r.length-1]).properties.heading=Dt(H(r[r.length-2],r[r.length-1])),R(r[r.length-1])}class Ae{constructor(){this.queue=new Array}addGuidance(t){this.queue.push(t),this.queue.sort((t,e)=>t.position-e.position)}removePreviousGuidance(t,e=0){let n=0;for(let r=0;r<this.queue.length;r++)if(this.queue[r].position>t+e){n=r;break}return n>0&&this.queue.splice(0,n),n}nextGuidance(t){for(let e=0;e<this.queue.length;e++)if(this.queue[e].position>t)return this.queue[e];return null}nearbyGuidance(t,e=15){e=Math.abs(e);const n=[];for(let r=0;r<this.queue.length;r++){const i=this.queue[r];if(!i.handled)if(0===n.length){const r=t-i.position;if(r<0&&r<-e)break;Math.abs(r)<=e&&(i.handled=!0,n.push(i))}else if(n.length<=1){if(!(i.position-n[n.length-1].position<=100&&i.toTurnDistance<=80))break;i.handled=!1,n.push(i)}}return n}clearQueue(){this.queue=[]}}class Pe extends Ae{nearbyGuidance(t,e=15){return super.nearbyGuidance(t,e)}}class Me{constructor(t){this._showQueue=new Ae,this._voiceQueue=new Pe,this._voiceMilestones=[4e4,2e4,1e4,5e3,2e3,1200,800,400,200,50],this.routeLeg=t}build(){const t=this.routeLeg.steps.length-1;let e=0;this.routeLeg.steps.forEach((n,r)=>{this.showGuidance(n,e),r<t&&this.voiceGuidance(n,this.routeLeg.steps[r+1],e),e+=n.distance})}showGuidance(t,e){const n=new Ie;n.position=e,n.location=t.geometry.coordinates[0],n.step=t,this._showQueue.addGuidance(n)}voiceGuidance(t,e,n){const r=[];let i;t.distance>=350?(i=t.distance-50,r.push(i)):i=t.distance,this._voiceMilestones.forEach(t=>{i>=t&&r.push(t)}),0===r.length&&r.push(1),e.maneuver.type===Gt.ARRIVE&&r.length>0&&r.pop(),r.forEach(r=>{const i=new Re;let o=t.distance-r;o<0&&(o=0);const s=_e(t.geometry,o/1e3);i.position=n+o,i.location=s.geometry.coordinates,i.toTurnDistance=r,i.step=e,i.currentStep=t,this._voiceQueue.addGuidance(i)})}get showQueue(){return this._showQueue}get voiceQueue(){return this._voiceQueue}}class Be{constructor(t){this.locations=t}getLastLocation(){return this.locations[this.locations.length-1]}getLocations(){return this.locations}}class Oe{}class Fe extends Oe{}!function(t){t.startNavigation="startNavigation",t.endNavigation="endNavigation",t.willEndNavigation="willEndNavigation",t.show="show",t.voice="voice",t.overspeed="overspeed",t.locationUpdate="locationUpdate",t.deviationRoute="deviationRoute",t.error="error",t.willEnterLastRoad="willEnterLastRoad"}(Ce||(Ce={}));var De=Ce;class je extends Fe{constructor(){super(),this.type=De.show}}class qe extends Fe{constructor(){super(),this.type=De.voice}}class Ue extends Oe{constructor(){super(),this.type=De.endNavigation}}class Ge extends Oe{constructor(){super(),this.type=De.startNavigation}}class He extends Oe{constructor(){super(),this.type=De.deviationRoute}}class Ye{}class Ve{constructor(t){this.validBbox=[[121.83,29.92,121.85,29.95],[121.85,29.91,121.89,29.94],[122.02,29.86,122.08,29.9],[121.72,29.96,121.77,29.99],[121.99,29.76,122.03,29.79]],this.lastPosition=0,this.isRunning=!1,this.options=t}setRouteLeg(t){this.routeLeg=t,this.lastLocation=null,this.lastPosition=0,this.isRunning=!1}updateLocation(t){if(!this.validLocation(t))return null;!this.isRunning&&t.speed>1&&(this.isRunning=!0);const e=this.getDirectionNearestPoint(t),n=e.geometry.coordinates,r=1e3*e.properties.dist,i=r-this.getLocationAccuracy(t)>this.options.deviationMaxDistance,o=1e3*e.properties.location,s=o-this.lastPosition;if((i||s<-50)&&this.options.listener){const e=new He;e.deviationDistance=r,e.linedPoint=n,e.location=t,e.routeLeg=this.routeLeg,this.options.listener.deviationRouteAlarm(e)}if(s<0&&s>=-10&&this.isRunning)return null;(t=t.clone()).longitude=n[0],t.latitude=n[1];const a=Dt(e.properties.direction);if((!t.heading||Math.abs(t.heading-a)<120)&&(t.heading=a),this.lastPosition=o,this.lastLocation=t,Ft(n,this.routeLeg.geometry.geometry.coordinates[0]))this.track=_([n,n]);else if(Ft(n,this.routeLeg.geometry.geometry.coordinates[this.routeLeg.geometry.geometry.coordinates.length-1]))this.track=Tt(this.routeLeg.geometry);else{const t=Et(this.routeLeg.geometry,e);this.track=t.features[0]}const c=new Ye;return c.location=t.clone(),c.position=o,c}validLocation(t){return-1!==this.validBbox.findIndex(e=>t.longitude>=e[0]&&t.longitude<=e[2]&&t.latitude>=e[1]&&t.latitude<=e[3])}getDirectionNearestPoint(t){if(t.hasSpeed()&&t.speed>=1){const e=R([t.longitude,t.latitude],{direction:t.heading});let n=te(this.routeLeg.geometry,e);return 1e3*n.properties.dist>this.options.deviationMaxDistance&&(n=te(this.routeLeg.geometry,[t.longitude,t.latitude])),n}return te(this.routeLeg.geometry,[t.longitude,t.latitude])}getLocationAccuracy(t){return t.hasAccuracy()?t.accuracy>50?50:t.accuracy:0}getTrack(){return this.track}}class Xe{constructor(){this.deviationMaxDistance=50,this.deviationMaxCount=3,this.deviationMaxTime=5e3}}class Je extends Oe{constructor(){super(),this.type=De.locationUpdate}}class We{constructor(){this.locationUpdateMinInterval=100,this.voiceGuidanceMinInterval=500,this.showGuidanceMinInterval=1e3,this.willEndNavigationDistance=50,this.overspeedRoad=!0,this.overspeedCheckInterval=2e3,this.overspeedRate=1.1,this.overspeedContinuedCount=3,this.hasWillEnterLastRoad=!1,this.willEnterLastRoadDistance=50}}class ze extends Oe{constructor(){super(),this.type=De.willEndNavigation}}class Qe{constructor(t){this.navigationListener=t}deviationRoute(t){if(this.navigationListener&&this.navigationListener.deviationRoute)try{this.navigationListener.deviationRoute(t)}catch(t){console.log(t)}else console.log("deviationRoute navigation listener isn't undefined")}willEndNavigation(t){if(this.navigationListener&&this.navigationListener.willEndNavigation)try{this.navigationListener.willEndNavigation(t)}catch(t){console.log(t)}else console.log("willEndNavigation navigation listener isn't undefined")}endNavigation(t){if(this.navigationListener&&this.navigationListener.endNavigation)try{this.navigationListener.endNavigation(t)}catch(t){console.log(t)}else console.log("endNavigation navigation listener isn't undefined")}error(t){if(this.navigationListener&&this.navigationListener.error)try{this.navigationListener.error(t)}catch(t){console.log(t)}else console.log("error navigation listener isn't undefined")}locationUpdate(t){if(this.navigationListener&&this.navigationListener.locationUpdate)try{this.navigationListener.locationUpdate(t)}catch(t){console.log(t)}else console.log("locationUpdate navigation listener isn't undefined")}overSpeed(t){if(this.navigationListener&&this.navigationListener.overSpeed)try{this.navigationListener.overSpeed(t)}catch(t){console.log(t)}else console.log("overSpeed navigation listener isn't undefined")}showTurn(t){if(this.navigationListener&&this.navigationListener.showTurn)try{this.navigationListener.showTurn(t)}catch(t){console.log(t)}else console.log("showTurn navigation listener isn't undefined")}startNavigation(t){if(this.navigationListener&&this.navigationListener.startNavigation)try{this.navigationListener.startNavigation(t)}catch(t){console.log(t)}else console.log("startNavigation navigation listener isn't undefined")}restartNavigation(t){if(this.navigationListener&&this.navigationListener.restartNavigation)try{this.navigationListener.restartNavigation(t)}catch(t){console.log(t)}else console.log("restartNavigation navigation listener isn't undefined")}voiceTurn(t){if(this.navigationListener&&this.navigationListener.voiceTurn)try{this.navigationListener.voiceTurn(t)}catch(t){console.log(t)}else console.log("voiceTurn navigation listener isn't undefined")}willEnterLastRoad(t){if(this.navigationListener&&this.navigationListener.willEnterLastRoad)try{this.navigationListener.willEnterLastRoad(t)}catch(t){console.log(t)}else console.log("willEnterLastRoad listener isn't undefined")}}class $e extends Oe{constructor(){super(),this.type=De.overspeed}}class Ke extends Fe{constructor(){super(),this.type=De.willEnterLastRoad}}class Ze extends Te{constructor(){super(),this.type=Se.turn}}class tn{constructor(t,e,n){this.finding=!1,this.navigationEnded=!1,this.navigationWillEnded=!1,this.lastTimeShowGuidance=0,this.lastTimeVoiceGuidance=0,this.lastTimeUpdateLocation=0,this.lastTimeOverspeed=0,this.currentOverspeedContinuedCount=0,this.willEnterLastRoadPosition=-1,this.willEnterLastRoadEnded=!1,this.options=Object.assign(new We,n),this.pathFinder=t,this.locationEngine=e,this.locationEngineCallback=this.locationEngineCallback.bind(this),this.deviationRouteAlarm=this.deviationRouteAlarm.bind(this);const r=new Xe;r.listener=this,this.routeManager=new Ve(r)}get hasWillEnterLastRoad(){return this.options.hasWillEnterLastRoad}set hasWillEnterLastRoad(t){!this.options.hasWillEnterLastRoad&&t&&(this.willEnterLastRoadPosition=-1),this.options.hasWillEnterLastRoad=t}get willEnterLastRoadDistance(){return this.options.willEnterLastRoadDistance}set willEnterLastRoadDistance(t){t!==this.options.willEnterLastRoadDistance&&(this.willEnterLastRoadPosition=-1),this.options.willEnterLastRoadDistance=t}deviationRouteAlarm(t){this.finding||(this.finding=!0,this.listener.deviationRoute(t),setTimeout(()=>{this.finding=!1},2e3))}getDestination(){const t=this.routeLeg.geometry.geometry.coordinates;return t[t.length-1]}restart(t){console.log("重新导航",t),this.stop(),this.sendRouteLegToRemote(t),this.routeLeg=t,this.routeManager.setRouteLeg(this.routeLeg);const e=new Me(t);e.build(),this.showQueue=e.showQueue,this.voiceQueue=e.voiceQueue,this.locationEngineCallbackId=this.locationEngine.addLocationEngineCallback(this.locationEngineCallback);const n=new Ge;n.target=this.routeLeg,n.location=this.locationEngine.getLastLocationSync(),this.listener.restartNavigation(n)}sendRouteLegToRemote(t){const e=this.locationEngine;if(e.getSocket){e.getSocket().emit("clientSetRouteLeg",{clientId:e.getClientId(),routeLeg:t})}}removeRemoteRouteLeg(){const t=this.locationEngine;if(t.getSocket){t.getSocket().emit("clientRemoveRouteLeg",{clientId:t.getClientId()})}}start(t,e){this.stop(),this.sendRouteLegToRemote(t),this.routeLeg=t,this.routeManager.setRouteLeg(this.routeLeg),this.listener=new Qe(e);const n=new Me(t);n.build(),this.showQueue=n.showQueue,this.voiceQueue=n.voiceQueue,this.locationEngineCallbackId=this.locationEngine.addLocationEngineCallback(this.locationEngineCallback);const r=new Ge;r.target=this.routeLeg,r.location=this.locationEngine.getLastLocationSync(),this.listener.startNavigation(r),this.locationEngine.getLastLocation((t,e)=>{const n=new Be([e.getLastLocation()]);this.locationEngineCallback(null,n)})}canUpdateLocation(){const t=tn.intervalGEThan(this.options.locationUpdateMinInterval,this.lastTimeUpdateLocation);return t&&(this.lastTimeUpdateLocation=Date.now()),t}canShowGuidance(){const t=tn.intervalGEThan(this.options.showGuidanceMinInterval,this.lastTimeShowGuidance);return t&&(this.lastTimeShowGuidance=Date.now()),t}canCheckOverspeed(){const t=tn.intervalGEThan(this.options.overspeedCheckInterval,this.lastTimeOverspeed);return t&&(this.lastTimeOverspeed=Date.now()),t}canVoiceGuidance(){const t=tn.intervalGEThan(this.options.voiceGuidanceMinInterval,this.lastTimeVoiceGuidance);return t&&(this.lastTimeVoiceGuidance=Date.now()),t}static intervalGEThan(t,e){return t<=0||Date.now()-e>=t}locationEngineCallback(t,e){if(t)return void console.log("定位失败",t);const n=this.routeManager.updateLocation(e.getLastLocation());if(!n)return;const r=this.routeLeg.distance-n.position;if(this.options.overspeedRoad&&this.canCheckOverspeed()&&this.checkOverspeed(n.location),this.canUpdateLocation()){const t=new Je;t.location=n.location,t.toDestinationDistance=r,t.toDestinationTime=Math.round(this.routeLeg.duration*r/this.routeLeg.distance),t.track=this.routeManager.getTrack(),this.listener.locationUpdate(t)}if(r<-1)console.log(`到目的地的距离为${r}，忽略该数据`);else{if(this.canVoiceGuidance()&&!this.navigationEnded&&this.toVoice(n),this.canShowGuidance()&&!this.navigationEnded&&this.toShow(n),this.options.hasWillEnterLastRoad&&!this.willEnterLastRoadEnded){if(this.willEnterLastRoadPosition<0){const t=this.routeLeg.steps[this.routeLeg.steps.length-2],e=this.routeLeg.distance-t.distance-this.options.willEnterLastRoadDistance;this.willEnterLastRoadPosition=e<0?0:e}if(n.position-this.willEnterLastRoadPosition>=-5){const t=new Ke;t.distance=this.options.willEnterLastRoadDistance,t.location=n.location;const e=new Ze;e.step=this.routeLeg.steps[this.routeLeg.steps.length-2],e.position=this.willEnterLastRoadPosition,t.target=e,this.listener.willEnterLastRoad(t),this.willEnterLastRoadEnded=!0}}if(function(t,e,n,r){const i=t-e;return i>=n&&i<=r}(r,this.options.willEndNavigationDistance,-10,10)&&!this.navigationWillEnded){const t=new ze;t.target=this.routeLeg,t.location=n.location,t.toDestinationDistance=r,this.navigationWillEnded=!0,this.listener.willEndNavigation(t)}if(r<=15&&!this.navigationEnded){const t=new Ue;t.target=this.routeLeg,t.location=n.location,this.navigationEnded=!0,this.listener.endNavigation(t)}}}checkOverspeed(t){const e=[t.longitude,t.latitude],n=this.pathFinder.getNearestLine().search(e,t.heading);if(n&&n.length>0){const e=n[0].nodeData;if(e.speed&&e.speed>1&&t&&t.speed>0){const n=3.6*t.speed;if(n/e.speed>this.options.overspeedRate){if(this.currentOverspeedContinuedCount++,this.currentOverspeedContinuedCount>=this.options.overspeedContinuedCount){const r=new $e;r.location=t,r.limitSpeed=e.speed,r.drivingSpeed=n,this.listener.overSpeed(r),this.currentOverspeedContinuedCount=0}return}}}this.currentOverspeedContinuedCount=0}toShow(t){const e=new je;e.location=t.location;const n=this.showQueue.nextGuidance(t.position);if(n){const r=n.position-t.position;e.distance=r,e.target=n,this.listener.showTurn(e),r<=10&&this.showQueue.removePreviousGuidance(n.position+1)}}toVoice(t){const e=new qe;e.location=t.location;const n=this.voiceQueue.nearbyGuidance(t.position,15);n.length>0&&(e.distance=0,e.target=n,this.listener.voiceTurn(e),this.voiceQueue.removePreviousGuidance(t.position,15))}init(){this.routeLeg=null,this.showQueue=null,this.voiceQueue=null,this.finding=!1,this.navigationEnded=!1,this.navigationWillEnded=!1,this.lastTimeShowGuidance=0,this.lastTimeVoiceGuidance=0,this.lastTimeUpdateLocation=0,this.currentOverspeedContinuedCount=0,this.willEnterLastRoadPosition=-1,this.willEnterLastRoadEnded=!1}stop(){this.locationEngineCallbackId&&(this.locationEngine.removeLocationEngineCallback(this.locationEngineCallbackId),this.locationEngineCallbackId=null),this.removeRemoteRouteLeg(),this.init()}}class en{constructor(){this.dataFrom="daohang_w"}hasAltitude(){return null!==this.altitude&&void 0!==this.altitude}hasAccuracy(){return null!==this.accuracy&&void 0!==this.accuracy}hasAltitudeAccuracy(){return null!==this.altitudeAccuracy&&void 0!==this.altitudeAccuracy}hasHeading(){return null!==this.heading&&void 0!==this.heading}hasSpeed(){return null!==this.speed&&void 0!==this.speed}clone(){return Object.assign(new en,JSON.parse(JSON.stringify(this)))}static hasValue(t){return null!=t}static noneValue(t){return null==t}}class nn{constructor(){this.locationEngineCallbacks={}}addLocationEngineCallback(t){const e=function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}();return this.locationEngineCallbacks[e]=t,e}removeLocationEngineCallback(t){const e=this.locationEngineCallbacks[t];return delete this.locationEngineCallbacks[t],e}clearLocationEngineCallbacks(){this.locationEngineCallbacks={}}loopHandleLocationEngineCallbacks(t,e){for(const n in this.locationEngineCallbacks)try{this.locationEngineCallbacks[n](t,e)}catch(t){console.log(this.getProvider()+" success callback",t)}}}class rn{constructor(){this.displacemnt=10,this.fastestInterval=500,this.interval=1e3,this.maxWaitTime=5e3,this.priority=rn.PRIORITY_BALANCED_POWER_ACCURACY}}rn.PRIORITY_HIGH_ACCURACY=0,rn.PRIORITY_BALANCED_POWER_ACCURACY=1,rn.PRIORITY_LOW_POWER=2,rn.PRIORITY_NO_POWER=3;class on{constructor(){this.tts="baidu",this.ttsOptions=null}}class sn extends class{}{constructor(){super(...arguments),this.url="https://tsn.baidu.com/text2audio",this.getBaiduTtsTokenUrl="https://zgnav.npedi.com/weixin/baiduttstoken",this.tok="24.ef41a484726957e9256bb75318d58f32.2592000.1568792103.282335-17042014",this.cuid="a1",this.ctp=1,this.lan="zh",this.spd=5,this.pit=5,this.vol=5}}class an{constructor(t){this.options=Object.assign(new sn,t)}text2audio(t,e){const n=Object.assign(new sn,this.options,e);return n.url+"?lan="+encodeURIComponent(n.lan)+"&ctp="+encodeURIComponent(n.ctp)+"&cuid="+encodeURIComponent(n.cuid)+"&tex="+encodeURIComponent(t)+"&tok="+n.tok+"&spd="+n.spd+"&pit="+n.pit+"&vol="+n.vol}}class cn{static instanceOf(t,e,n){if("baidu"!==t)throw new Error("现在只支持百度tts, ttsName必须为baidu");let r=cn.ttsHash[t];if(r)n&&n(null,r);else{const t=Object.assign(new sn,e);xe.factory(t.getBaiduTtsTokenUrl).get().json(e=>{e.error?n&&n(e.error):(t.tok=e.access_token,r=new an(t),cn.ttsHash[name]=r,n&&n(null,r))}).catch(t=>{n&&n(t)})}}}cn.ttsHash={};class hn{constructor(t){this.playList=[],this.playing=!1,this.options=Object.assign(new on,t),cn.instanceOf(this.options.tts,this.options.ttsOptions,(t,e)=>{t?console.log("获得百度token失败，语音播报将会不成功"):this.tts=e}),this.playEndedHandler=this.playEndedHandler.bind(this);let e=document.getElementById(hn.VOICE_PLAYER_AUDIO_ID);e&&(e.parentElement.removeChild(e),console.log("警告, HtmlVoicePlayer被多次初始化")),e=new Audio,e.autoplay=!0,e.id=hn.VOICE_PLAYER_AUDIO_ID,document.body.appendChild(e),e.addEventListener("ended",this.playEndedHandler,!1),this.audio=e}playEndedHandler(){this.playing=!1,this.playList.length>0&&(this.playing=!0,this.audio.src=this.playList.pop(),this.audio.play())}addVoiceText(t){const e=this.tts.text2audio(t);this.playList.unshift(e),this.playing||this.playEndedHandler()}clearVoiceTexts(){this.playList=[]}playVoiceTextNow(t){this.playing=!0,this.audio.src=this.tts.text2audio(t),this.audio.play()}pause(){this.audio.pause()}}hn.VOICE_PLAYER_AUDIO_ID="VPAI_SRD12DRE";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var un=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){
/*!
     * Socket.IO v2.2.0
     * (c) 2014-2018 Guillermo Rauch
     * Released under the MIT License.
     */
t.exports=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){function r(t,e){"object"===(void 0===t?"undefined":i(t))&&(e=t,t=void 0),e=e||{};var n,r=o(t),s=r.source,u=r.id,l=r.path,d=h[u]&&l in h[u].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||d?(c("ignoring socket cache for %s",s),n=a(s,e)):(h[u]||(c("new io instance for %s",s),h[u]=a(s,e)),n=h[u]),r.query&&!e.query&&(e.query=r.query),n.socket(r.path,e)}var i="function"==typeof Symbol&&"symbol"==C(Symbol.iterator)?function(t){return C(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":C(t)},o=n(1),s=n(7),a=n(12),c=n(3)("socket.io-client");t.exports=e=r;var h=e.managers={};e.protocol=s.protocol,e.connect=r,e.Manager=n(12),e.Socket=n(36)},function(t,e,n){var r=n(2),i=n(3)("socket.io-client:url");t.exports=function(t,e){var n=t;e=e||"undefined"!=typeof location&&location,null==t&&(t=e.protocol+"//"+e.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),i("parse %s",t),n=r(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var o=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port,n.href=n.protocol+"://"+o+(e&&e.port===n.port?"":":"+n.port),n}},function(t,e){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,i=t.indexOf("["),o=t.indexOf("]");-1!=i&&-1!=o&&(t=t.substring(0,i)+t.substring(i,o).replace(/:/g,";")+t.substring(o,t.length));for(var s=n.exec(t||""),a={},c=14;c--;)a[r[c]]=s[c]||"";return-1!=i&&-1!=o&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(t,e,n){(function(r){function i(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG),t}(e=t.exports=n(5)).log=function(){return"object"==("undefined"==typeof console?"undefined":C(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var i=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(i++,"%c"===t&&(o=i))})),t.splice(o,0,r)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=i,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(i())}).call(e,n(4))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(t){if(h===setTimeout)return setTimeout(t,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function o(){f&&d&&(f=!1,d.length?p=d.concat(p):g=-1,p.length&&s())}function s(){if(!f){var t=i(o);f=!0;for(var e=p.length;e;){for(d=p,p=[];++g<e;)d&&d[g].run();g=-1,e=p.length}d=null,f=!1,function(t){if(u===clearTimeout)return clearTimeout(t);if((u===r||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(t);try{u(t)}catch(e){try{return u.call(null,t)}catch(e){return u.call(this,t)}}}(t)}}function a(t,e){this.fun=t,this.array=e}function c(){}var h,u,l=t.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(t){h=n}try{u="function"==typeof clearTimeout?clearTimeout:r}catch(t){u=r}}();var d,p=[],f=!1,g=-1;l.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new a(t,e)),1!==p.length||f||i(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=c,l.addListener=c,l.once=c,l.off=c,l.removeListener=c,l.removeAllListeners=c,l.emit=c,l.prependListener=c,l.prependOnceListener=c,l.listeners=function(t){return[]},l.binding=function(t){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(t){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(t,e,n){function r(t){function n(){if(n.enabled){var t=n,i=+new Date,o=i-(r||i);t.diff=o,t.prev=r,t.curr=i,r=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;c++;var i=e.formatters[r];if("function"==typeof i){var o=s[c];n=i.call(t,o),s.splice(c,1),c--}return n})),e.formatArgs.call(t,s);var h=n.log||e.log||console.log.bind(console);h.apply(t,s)}}var r;return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),n.destroy=i,"function"==typeof e.init&&e.init(n),e.instances.push(n),n}function i(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=r.debug=r.default=r).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){e.save(t),e.names=[],e.skips=[];var n,r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var o=e.instances[n];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(6),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){function n(t){return r(t,a,"day")||r(t,s,"hour")||r(t,o,"minute")||r(t,i,"second")||t+" ms"}function r(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var i=1e3,o=60*i,s=60*o,a=24*s,c=365.25*a;t.exports=function(t,e){e=e||{};var r=C(t);if("string"===r&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*c;case"days":case"day":case"d":return n*a;case"hours":case"hour":case"hrs":case"hr":case"h":return n*s;case"minutes":case"minute":case"mins":case"min":case"m":return n*o;case"seconds":case"second":case"secs":case"sec":case"s":return n*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(t);if("number"===r&&!1===isNaN(t))return e.long?n(t):function(t){return t>=a?Math.round(t/a)+"d":t>=s?Math.round(t/s)+"h":t>=o?Math.round(t/o)+"m":t>=i?Math.round(t/i)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){function r(){}function i(t){var n=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(n+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(n+=t.nsp+","),null!=t.id&&(n+=t.id),null!=t.data){var r=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===r)return f;n+=r}return h("encoded %j as %s",t,n),n}function o(){this.reconstructor=null}function s(t){var n=0,r={type:Number(t.charAt(0))};if(null==e.types[r.type])return c("unknown packet type "+r.type);if(e.BINARY_EVENT===r.type||e.BINARY_ACK===r.type){for(var i="";"-"!==t.charAt(++n)&&(i+=t.charAt(n),n!=t.length););if(i!=Number(i)||"-"!==t.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===t.charAt(n+1))for(r.nsp="";++n&&","!==(s=t.charAt(n))&&(r.nsp+=s,n!==t.length););else r.nsp="/";var o=t.charAt(n+1);if(""!==o&&Number(o)==o){for(r.id="";++n;){var s;if(null==(s=t.charAt(n))||Number(s)!=s){--n;break}if(r.id+=t.charAt(n),n===t.length)break}r.id=Number(r.id)}if(t.charAt(++n)){var a=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(n));if(!1===a||r.type!==e.ERROR&&!d(a))return c("invalid payload");r.data=a}return h("decoded %s as %j",t,r),r}function a(t){this.reconPack=t,this.buffers=[]}function c(t){return{type:e.ERROR,data:"parser error: "+t}}var h=n(3)("socket.io-parser"),u=n(8),l=n(9),d=n(10),p=n(11);e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=r,e.Decoder=o;var f=e.ERROR+'"encode error"';r.prototype.encode=function(t,n){h("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type?function(t,e){l.removeBlobs(t,(function(t){var n=l.deconstructPacket(t),r=i(n.packet),o=n.buffers;o.unshift(r),e(o)}))}(t,n):n([i(t)])},u(o.prototype),o.prototype.add=function(t){var n;if("string"==typeof t)n=s(t),e.BINARY_EVENT===n.type||e.BINARY_ACK===n.type?(this.reconstructor=new a(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!p(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",n))}},o.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},a.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=l.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},a.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e,n){function r(t){if(t)return function(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}(t)}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,e);return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){var r=n(10),i=n(11),o=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===o.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===o.call(File);e.deconstructPacket=function(t){var e=[],n=t.data,o=t;return o.data=function t(e,n){if(!e)return e;if(i(e)){var o={_placeholder:!0,num:n.length};return n.push(e),o}if(r(e)){for(var s=new Array(e.length),a=0;a<e.length;a++)s[a]=t(e[a],n);return s}if("object"==C(e)&&!(e instanceof Date)){for(var c in s={},e)s[c]=t(e[c],n);return s}return e}(n,e),o.attachments=e.length,{packet:o,buffers:e}},e.reconstructPacket=function(t,e){return t.data=function t(e,n){if(!e)return e;if(e&&e._placeholder)return n[e.num];if(r(e))for(var i=0;i<e.length;i++)e[i]=t(e[i],n);else if("object"==C(e))for(var o in e)e[o]=t(e[o],n);return e}(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){var n=0,o=t;(function t(c,h,u){if(!c)return c;if(s&&c instanceof Blob||a&&c instanceof File){n++;var l=new FileReader;l.onload=function(){u?u[h]=this.result:o=this.result,--n||e(o)},l.readAsArrayBuffer(c)}else if(r(c))for(var d=0;d<c.length;d++)t(c[d],d,c);else if("object"==C(c)&&!i(c))for(var p in c)t(c[p],p,c)})(o),n||e(o)}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e){t.exports=function(t){return n&&Buffer.isBuffer(t)||r&&(t instanceof ArrayBuffer||i(t))};var n="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,r="function"==typeof ArrayBuffer,i=function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer}},function(t,e,n){function r(t,e){if(!(this instanceof r))return new r(t,e);t&&"object"===(void 0===t?"undefined":i(t))&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||c;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}var i="function"==typeof Symbol&&"symbol"==C(Symbol.iterator)?function(t){return C(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":C(t)},o=n(13),s=n(36),a=n(8),c=n(7),h=n(38),u=n(39),l=n(3)("socket.io-client:manager"),d=n(35),p=n(40),f=Object.prototype.hasOwnProperty;t.exports=r,r.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)f.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},r.prototype.updateSocketIds=function(){for(var t in this.nsps)f.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},r.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},a(r.prototype),r.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},r.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},r.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=r.prototype.connect=function(t,e){if(l("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;l("opening %s",this.uri),this.engine=o(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=h(n,"open",(function(){r.onopen(),t&&t()})),s=h(n,"error",(function(e){if(l("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var a=this._timeout;l("connect attempt will timeout after %d",a);var c=setTimeout((function(){l("connect attempt timed out after %d",a),i.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",a)}),a);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(i),this.subs.push(s),this},r.prototype.onopen=function(){l("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(h(t,"data",u(this,"ondata"))),this.subs.push(h(t,"ping",u(this,"onping"))),this.subs.push(h(t,"pong",u(this,"onpong"))),this.subs.push(h(t,"error",u(this,"onerror"))),this.subs.push(h(t,"close",u(this,"onclose"))),this.subs.push(h(this.decoder,"decoded",u(this,"ondecoded")))},r.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},r.prototype.ondata=function(t){this.decoder.add(t)},r.prototype.ondecoded=function(t){this.emit("packet",t)},r.prototype.onerror=function(t){l("error",t),this.emitAll("error",t)},r.prototype.socket=function(t,e){function n(){~d(i.connecting,r)||i.connecting.push(r)}var r=this.nsps[t];if(!r){r=new s(this,t,e),this.nsps[t]=r;var i=this;r.on("connecting",n),r.on("connect",(function(){r.id=i.generateId(t)})),this.autoConnect&&n()}return r},r.prototype.destroy=function(t){var e=d(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},r.prototype.packet=function(t){l("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,(function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()})))},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},r.prototype.cleanup=function(){l("cleanup");for(var t=this.subs.length,e=0;e<t;e++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},r.prototype.close=r.prototype.disconnect=function(){l("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},r.prototype.onclose=function(t){l("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();l("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout((function(){t.skipReconnect||(l("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open((function(e){e?(l("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(l("reconnect success"),t.onreconnect())})))}),e);this.subs.push({destroy:function(){clearTimeout(n)}})}},r.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},function(t,e,n){t.exports=n(14),t.exports.parser=n(21)},function(t,e,n){function r(t,e){return this instanceof r?(e=e||{},t&&"object"==C(t)&&(e=t,t=null),t?(t=h(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=h(e.host).host),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,void this.open()):new r(t,e)}var i=n(15),o=n(8),s=n(3)("engine.io-client:socket"),a=n(35),c=n(21),h=n(2),u=n(29);t.exports=r,r.priorWebsocketSuccess=!1,o(r.prototype),r.protocol=c.protocol,r.Socket=r,r.Transport=n(20),r.transports=n(15),r.parser=n(21),r.prototype.createTransport=function(t){s('creating transport "%s"',t);var e=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(this.query);e.EIO=c.protocol,e.transport=t;var n=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new i[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},r.prototype.open=function(){var t;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout((function(){e.emit("error","No transports available")}),0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},r.prototype.setTransport=function(t){s("setting transport %s",t.name);var e=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",(function(){e.onDrain()})).on("packet",(function(t){e.onPacket(t)})).on("error",(function(t){e.onError(t)})).on("close",(function(){e.onClose("transport close")}))},r.prototype.probe=function(t){function e(){if(d.onlyBinaryUpgrades){var e=!this.supportsBinary&&d.transport.supportsBinary;l=l||e}l||(s('probe transport "%s" opened',t),u.send([{type:"ping",data:"probe"}]),u.once("packet",(function(e){if(!l)if("pong"===e.type&&"probe"===e.data){if(s('probe transport "%s" pong',t),d.upgrading=!0,d.emit("upgrading",u),!u)return;r.priorWebsocketSuccess="websocket"===u.name,s('pausing current transport "%s"',d.transport.name),d.transport.pause((function(){l||"closed"!==d.readyState&&(s("changing transport and sending upgrade packet"),h(),d.setTransport(u),u.send([{type:"upgrade"}]),d.emit("upgrade",u),u=null,d.upgrading=!1,d.flush())}))}else{s('probe transport "%s" failed',t);var n=new Error("probe error");n.transport=u.name,d.emit("upgradeError",n)}})))}function n(){l||(l=!0,h(),u.close(),u=null)}function i(e){var r=new Error("probe error: "+e);r.transport=u.name,n(),s('probe transport "%s" failed because of error: %s',t,e),d.emit("upgradeError",r)}function o(){i("transport closed")}function a(){i("socket closed")}function c(t){u&&t.name!==u.name&&(s('"%s" works - aborting "%s"',t.name,u.name),n())}function h(){u.removeListener("open",e),u.removeListener("error",i),u.removeListener("close",o),d.removeListener("close",a),d.removeListener("upgrading",c)}s('probing transport "%s"',t);var u=this.createTransport(t,{probe:1}),l=!1,d=this;r.priorWebsocketSuccess=!1,u.once("open",e),u.once("error",i),u.once("close",o),this.once("close",a),this.once("upgrading",c),u.open()},r.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},r.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else s('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},r.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout((function(){"closed"!==e.readyState&&e.onClose("ping timeout")}),t||e.pingInterval+e.pingTimeout)},r.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout((function(){s("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)}),t.pingInterval)},r.prototype.ping=function(){var t=this;this.sendPacket("ping",(function(){t.emit("ping")}))},r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},r.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:t,data:e,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},r.prototype.close=function(){function t(){r.onClose("forced close"),s("socket closing - telling transport to close"),r.transport.close()}function e(){r.removeListener("upgrade",e),r.removeListener("upgradeError",e),t()}function n(){r.once("upgrade",e),r.once("upgradeError",e)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?n():t()})):this.upgrading?n():t()}return this},r.prototype.onError=function(t){s("socket error %j",t),r.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},r.prototype.onClose=function(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(s('socket close with reason: "%s"',t),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)},r.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~a(this.transports,t[n])&&e.push(t[n]);return e}},function(t,e,n){var r=n(16),i=n(18),o=n(32),s=n(33);e.polling=function(t){var e=!1,n=!1,s=!1!==t.jsonp;if("undefined"!=typeof location){var a="https:"===location.protocol,c=location.port;c||(c=a?443:80),e=t.hostname!==location.hostname||c!==t.port,n=t.secure!==a}if(t.xdomain=e,t.xscheme=n,"open"in new r(t)&&!t.forceJSONP)return new i(t);if(!s)throw new Error("JSONP disabled");return new o(t)},e.websocket=s},function(t,e,n){var r=n(17);t.exports=function(t){var e=t.xdomain,n=t.xscheme,i=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||r))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!n&&i)return new XDomainRequest}catch(t){}if(!e)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},function(t,e,n){function r(){}function i(t){if(c.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,"undefined"!=typeof location){var e="https:"===location.protocol,n=location.port;n||(n=e?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}}function o(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function s(){for(var t in o.requests)o.requests.hasOwnProperty(t)&&o.requests[t].abort()}var a=n(16),c=n(19),h=n(8),u=n(30),l=n(3)("engine.io-client:polling-xhr");if(t.exports=i,t.exports.Request=o,u(i,c),i.prototype.supportsBinary=!0,i.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new o(t)},i.prototype.doWrite=function(t,e){var n="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:n}),i=this;r.on("success",e),r.on("error",(function(t){i.onError("xhr post error",t)})),this.sendXhr=r},i.prototype.doPoll=function(){l("xhr poll");var t=this.request(),e=this;t.on("data",(function(t){e.onData(t)})),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t},h(o.prototype),o.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new a(t),n=this;try{l("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this.extraHeaders[r])}catch(t){}if("POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=!0),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){n.onLoad()},e.onerror=function(){n.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===t&&(e.responseType="arraybuffer")}catch(t){}4===e.readyState&&(200===e.status||1223===e.status?n.onLoad():setTimeout((function(){n.onError(e.status)}),0))},l("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout((function(){n.onError(t)}),0)}"undefined"!=typeof document&&(this.index=o.requestsCount++,o.requests[this.index]=this)},o.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},o.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},o.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},o.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete o.requests[this.index],this.xhr=null}},o.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t="application/octet-stream"===e&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},o.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},o.prototype.abort=function(){this.cleanup()},o.requestsCount=0,o.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",s);else if("function"==typeof addEventListener){var d="onpagehide"in self?"pagehide":"unload";addEventListener(d,s,!1)}},function(t,e,n){function r(t){var e=t&&t.forceBase64;u&&!e||(this.supportsBinary=!1),i.call(this,t)}var i=n(20),o=n(29),s=n(21),a=n(30),c=n(31),h=n(3)("engine.io-client:polling");t.exports=r;var u=null!=new(n(16))({xdomain:!1}).responseType;a(r,i),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(t){function e(){h("paused"),n.readyState="paused",t()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(h("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){h("pre-pause polling complete"),--r||e()}))),this.writable||(h("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){h("pre-pause writing complete"),--r||e()})))}else e()},r.prototype.poll=function(){h("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(t){var e=this;h("polling got data %s",t),s.decodePayload(t,this.socket.binaryType,(function(t,n,r){return"opening"===e.readyState&&e.onOpen(),"close"===t.type?(e.onClose(),!1):void e.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():h('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){function t(){h("writing close packet"),e.write([{type:"close"}])}var e=this;"open"===this.readyState?(h("transport open - closing"),t()):(h("transport not open - deferring close"),this.once("open",t))},r.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};s.encodePayload(t,this.supportsBinary,(function(t){e.doWrite(t,n)}))},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(t[this.timestampParam]=c()),this.supportsBinary||t.sid||(t.b64=1),t=o.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t}},function(t,e,n){function r(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}var i=n(21),o=n(8);t.exports=r,o(r.prototype),r.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},r.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},r.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(t){var e=i.decodePacket(t,this.socket.binaryType);this.onPacket(e)},r.prototype.onPacket=function(t){this.emit("packet",t)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(t,e,n){function r(t,n){return n("b"+e.packets[t.type]+t.data.data)}function i(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var i=t.data,o=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=y[t.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return r(s.buffer)}function o(t,n,r){if(!n)return e.encodeBase64Packet(t,r);if(g)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var i=new FileReader;return i.onload=function(){e.encodePacket({type:t.type,data:i.result},n,!0,r)},i.readAsArrayBuffer(t.data)}(t,n,r);var i=new Uint8Array(1);return i[0]=y[t.type],r(new b([i.buffer,t.data]))}function s(t,e,n){for(var r=new Array(t.length),i=l(t.length,n),o=function(t,n,i){e(n,(function(e,n){r[t]=n,i(e,r)}))},s=0;s<t.length;s++)o(s,t[s],i)}var a,c=n(22),h=n(23),u=n(24),l=n(25),d=n(26);"undefined"!=typeof ArrayBuffer&&(a=n(27));var p="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),f="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),g=p||f;e.protocol=3;var y=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},m=c(y),v={type:"error",data:"parser error"},b=n(28);e.encodePacket=function(t,e,n,s){"function"==typeof e&&(s=e,e=!1),"function"==typeof n&&(s=n,n=null);var a=void 0===t.data?void 0:t.data.buffer||t.data;if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return i(t,e,s);if(void 0!==b&&a instanceof b)return o(t,e,s);if(a&&a.base64)return r(t,s);var c=y[t.type];return void 0!==t.data&&(c+=n?d.encode(String(t.data),{strict:!1}):String(t.data)),s(""+c)},e.encodeBase64Packet=function(t,n){var r,i="b"+e.packets[t.type];if(void 0!==b&&t.data instanceof b){var o=new FileReader;return o.onload=function(){var t=o.result.split(",")[1];n(i+t)},o.readAsDataURL(t.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var s=new Uint8Array(t.data),a=new Array(s.length),c=0;c<s.length;c++)a[c]=s[c];r=String.fromCharCode.apply(null,a)}return i+=btoa(r),n(i)},e.decodePacket=function(t,n,r){if(void 0===t)return v;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),n);if(r&&!1===(t=function(t){try{t=d.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return v;var i=t.charAt(0);return Number(i)==i&&m[i]?t.length>1?{type:m[i],data:t.substring(1)}:{type:m[i]}:v}i=new Uint8Array(t)[0];var o=u(t,1);return b&&"blob"===n&&(o=new b([o])),{type:m[i],data:o}},e.decodeBase64Packet=function(t,e){var n=m[t.charAt(0)];if(!a)return{type:n,data:{base64:!0,data:t.substr(1)}};var r=a.decode(t.substr(1));return"blob"===e&&b&&(r=new b([r])),{type:n,data:r}},e.encodePayload=function(t,n,r){"function"==typeof n&&(r=n,n=null);var i=h(t);return n&&i?b&&!g?e.encodePayloadAsBlob(t,r):e.encodePayloadAsArrayBuffer(t,r):t.length?void s(t,(function(t,r){e.encodePacket(t,!!i&&n,!1,(function(t){r(null,function(t){return t.length+":"+t}(t))}))}),(function(t,e){return r(e.join(""))})):r("0:")},e.decodePayload=function(t,n,r){if("string"!=typeof t)return e.decodePayloadAsBinary(t,n,r);var i;if("function"==typeof n&&(r=n,n=null),""===t)return r(v,0,1);for(var o,s,a="",c=0,h=t.length;c<h;c++){var u=t.charAt(c);if(":"===u){if(""===a||a!=(o=Number(a)))return r(v,0,1);if(a!=(s=t.substr(c+1,o)).length)return r(v,0,1);if(s.length){if(i=e.decodePacket(s,n,!1),v.type===i.type&&v.data===i.data)return r(v,0,1);if(!1===r(i,c+o,h))return}c+=o,a=""}else a+=u}return""!==a?r(v,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){return t.length?void s(t,(function(t,n){e.encodePacket(t,!0,!0,(function(t){return n(null,t)}))}),(function(t,e){var r=e.reduce((function(t,e){var n;return t+(n="string"==typeof e?e.length:e.byteLength).toString().length+n+2}),0),i=new Uint8Array(r),o=0;return e.forEach((function(t){var e="string"==typeof t,n=t;if(e){for(var r=new Uint8Array(t.length),s=0;s<t.length;s++)r[s]=t.charCodeAt(s);n=r.buffer}i[o++]=e?0:1;var a=n.byteLength.toString();for(s=0;s<a.length;s++)i[o++]=parseInt(a[s]);for(i[o++]=255,r=new Uint8Array(n),s=0;s<r.length;s++)i[o++]=r[s]})),n(i.buffer)})):n(new ArrayBuffer(0))},e.encodePayloadAsBlob=function(t,n){s(t,(function(t,n){e.encodePacket(t,!0,!0,(function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);t=r.buffer,e[0]=0}var o=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),s=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)s[i]=parseInt(o[i]);if(s[o.length]=255,b){var a=new b([e.buffer,s.buffer,t]);n(null,a)}}))}),(function(t,e){return n(new b(e))}))},e.decodePayloadAsBinary=function(t,n,r){"function"==typeof n&&(r=n,n=null);for(var i=t,o=[];i.byteLength>0;){for(var s=new Uint8Array(i),a=0===s[0],c="",h=1;255!==s[h];h++){if(c.length>310)return r(v,0,1);c+=s[h]}i=u(i,2+c.length),c=parseInt(c);var l=u(i,0,c);if(a)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(t){var d=new Uint8Array(l);for(l="",h=0;h<d.length;h++)l+=String.fromCharCode(d[h])}o.push(l),i=u(i,c)}var p=o.length;o.forEach((function(t,i){r(e.decodePacket(t,n,!0),i,p)}))}},function(t,e){t.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e}},function(t,e,n){var r=n(10),i=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),s="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);t.exports=function t(e){if(!e||"object"!=C(e))return!1;if(r(e)){for(var n=0,i=e.length;n<i;n++)if(t(e[n]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||o&&e instanceof Blob||s&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return t(e.toJSON(),!0);for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&t(e[a]))return!0;return!1}},function(t,e){t.exports=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(t),o=new Uint8Array(n-e),s=e,a=0;s<n;s++,a++)o[a]=i[s];return o.buffer}},function(t,e){function n(){}t.exports=function(t,e,r){function i(t,n){if(i.count<=0)throw new Error("after called too many times");--i.count,t?(o=!0,e(t),e=r):0!==i.count||o||e(null,n)}var o=!1;return r=r||n,i.count=t,0===t?e():i}},function(t,e){function n(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function r(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function i(t,e){return l(t>>e&63|128)}function o(t,e){if(0==(4294967168&t))return l(t);var n="";return 0==(4294965248&t)?n=l(t>>6&31|192):0==(4294901760&t)?(r(t,e)||(t=65533),n=l(t>>12&15|224),n+=i(t,6)):0==(4292870144&t)&&(n=l(t>>18&7|240),n+=i(t,12),n+=i(t,6)),n+l(63&t|128)}function s(){if(u>=h)throw Error("Invalid byte index");var t=255&c[u];if(u++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function a(t){var e,n;if(u>h)throw Error("Invalid byte index");if(u==h)return!1;if(e=255&c[u],u++,0==(128&e))return e;if(192==(224&e)){if((n=(31&e)<<6|s())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&e)){if((n=(15&e)<<12|s()<<6|s())>=2048)return r(n,t)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(n=(7&e)<<18|s()<<12|s()<<6|s())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}
/*! https://mths.be/utf8js v2.1.2 by @mathias */
var c,h,u,l=String.fromCharCode;t.exports={version:"2.1.2",encode:function(t,e){for(var r=!1!==(e=e||{}).strict,i=n(t),s=i.length,a=-1,c="";++a<s;)c+=o(i[a],r);return c},decode:function(t,e){var r=!1!==(e=e||{}).strict;c=n(t),h=c.length,u=0;for(var i,o=[];!1!==(i=a(r));)o.push(i);return function(t){for(var e,n=t.length,r=-1,i="";++r<n;)(e=t[r])>65535&&(i+=l((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=l(e);return i}(o)}}},function(t,e){!function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<t.length;r++)n[t.charCodeAt(r)]=r;e.encode=function(e){var n,r=new Uint8Array(e),i=r.length,o="";for(n=0;n<i;n+=3)o+=t[r[n]>>2],o+=t[(3&r[n])<<4|r[n+1]>>4],o+=t[(15&r[n+1])<<2|r[n+2]>>6],o+=t[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},e.decode=function(t){var e,r,i,o,s,a=.75*t.length,c=t.length,h=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(e=0;e<c;e+=4)r=n[t.charCodeAt(e)],i=n[t.charCodeAt(e+1)],o=n[t.charCodeAt(e+2)],s=n[t.charCodeAt(e+3)],l[h++]=r<<2|i>>4,l[h++]=(15&i)<<4|o>>2,l[h++]=(3&o)<<6|63&s;return u}}()},function(t,e){function n(t){return t.map((function(t){if(t.buffer instanceof ArrayBuffer){var e=t.buffer;if(t.byteLength!==e.byteLength){var n=new Uint8Array(t.byteLength);n.set(new Uint8Array(e,t.byteOffset,t.byteLength)),e=n.buffer}return e}return t}))}function r(t,e){e=e||{};var r=new o;return n(t).forEach((function(t){r.append(t)})),e.type?r.getBlob(e.type):r.getBlob()}function i(t,e){return new Blob(n(t),e||{})}var o=void 0!==o?o:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,s=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),a=s&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),c=o&&o.prototype.append&&o.prototype.getBlob;"undefined"!=typeof Blob&&(r.prototype=Blob.prototype,i.prototype=Blob.prototype),t.exports=s?a?Blob:i:c?r:void 0},function(t,e){e.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},e.decode=function(t){for(var e={},n=t.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}},function(t,e){t.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){function n(t){var e="";do{e=o[t%s]+e,t=Math.floor(t/s)}while(t>0);return e}function r(){var t=n(+new Date);return t!==i?(c=0,i=t):t+"."+n(c++)}for(var i,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s=64,a={},c=0,h=0;h<s;h++)a[o[h]]=h;r.encode=n,r.decode=function(t){var e=0;for(h=0;h<t.length;h++)e=e*s+a[t.charAt(h)];return e},t.exports=r},function(t,e,n){(function(e){function r(){}function i(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{}}function o(t){if(s.call(this,t),this.query=this.query||{},!c){var e=i();c=e.___eio=e.___eio||[]}this.index=c.length;var n=this;c.push((function(t){n.onData(t)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=r)}),!1)}var s=n(19),a=n(30);t.exports=o;var c,h=/\n/g,u=/\\n/g;a(o,s),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),s.prototype.doClose.call(this)},o.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)}),100)},o.prototype.doWrite=function(t,e){function n(){r(),e()}function r(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(t){i.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+i.iframeId+'">';o=document.createElement(t)}catch(t){(o=document.createElement("iframe")).name=i.iframeId,o.src="javascript:0"}o.id=i.iframeId,i.form.appendChild(o),i.iframe=o}var i=this;if(!this.form){var o,s=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),r(),t=t.replace(u,"\\\n"),this.area.value=t.replace(h,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===i.iframe.readyState&&n()}:this.iframe.onload=n}}).call(e,function(){return this}())},function(t,e,n){function r(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=i&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(d=o),s.call(this,t)}var i,o,s=n(20),a=n(21),c=n(29),h=n(30),u=n(31),l=n(3)("engine.io-client:websocket");if("undefined"==typeof self)try{o=n(34)}catch(t){}else i=self.WebSocket||self.MozWebSocket;var d=i||o;t.exports=r,h(r,s),r.prototype.name="websocket",r.prototype.supportsBinary=!0,r.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new d(t,e):new d(t):new d(t,e,n)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},r.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},r.prototype.write=function(t){var e=this;this.writable=!1;for(var n=t.length,r=0,i=n;r<i;r++)!function(t){a.encodePacket(t,e.supportsBinary,(function(r){if(!e.usingBrowserWebSocket){var i={};t.options&&(i.compress=t.options.compress),e.perMessageDeflate&&("string"==typeof r?Buffer.byteLength(r):r.length)<e.perMessageDeflate.threshold&&(i.compress=!1)}try{e.usingBrowserWebSocket?e.ws.send(r):e.ws.send(r,i)}catch(t){l("websocket closed before onclose event")}--n||(e.emit("flush"),setTimeout((function(){e.writable=!0,e.emit("drain")}),0))}))}(t[r])},r.prototype.onClose=function(){s.prototype.onClose.call(this)},r.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=u()),this.supportsBinary||(t.b64=1),(t=c.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t},r.prototype.check=function(){return!(!d||"__initialize"in d&&this.name===r.prototype.name)}},function(t,e){},function(t,e){var n=[].indexOf;t.exports=function(t,e){if(n)return t.indexOf(e);for(var r=0;r<t.length;++r)if(t[r]===e)return r;return-1}},function(t,e,n){function r(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}var i="function"==typeof Symbol&&"symbol"==C(Symbol.iterator)?function(t){return C(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":C(t)},o=n(7),s=n(8),a=n(37),c=n(38),h=n(39),u=n(3)("socket.io-client:socket"),l=n(29),d=n(23);t.exports=r;var p={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=s.prototype.emit;s(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[c(t,"open",h(this,"onopen")),c(t,"packet",h(this,"onpacket")),c(t,"close",h(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},r.prototype.send=function(){var t=a(arguments);return t.unshift("message"),this.emit.apply(this,t),this},r.prototype.emit=function(t){if(p.hasOwnProperty(t))return f.apply(this,arguments),this;var e=a(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:d(e))?o.BINARY_EVENT:o.EVENT,data:e,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},r.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},r.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"===i(this.query)?l.encode(this.query):this.query;u("sending connect packet with query %s",t),this.packet({type:o.CONNECT,query:t})}else this.packet({type:o.CONNECT})},r.prototype.onclose=function(t){u("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},r.prototype.onpacket=function(t){var e=t.nsp===this.nsp,n=t.type===o.ERROR&&"/"===t.nsp;if(e||n)switch(t.type){case o.CONNECT:this.onconnect();break;case o.EVENT:case o.BINARY_EVENT:this.onevent(t);break;case o.ACK:case o.BINARY_ACK:this.onack(t);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",t.data)}},r.prototype.onevent=function(t){var e=t.data||[];u("emitting event %j",e),null!=t.id&&(u("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?f.apply(this,e):this.receiveBuffer.push(e)},r.prototype.ack=function(t){var e=this,n=!1;return function(){if(!n){n=!0;var r=a(arguments);u("sending ack %j",r),e.packet({type:d(r)?o.BINARY_ACK:o.ACK,id:t,data:r})}}},r.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(u("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):u("bad ack %s",t.id)},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)f.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.compress=function(t){return this.flags.compress=t,this},r.prototype.binary=function(t){return this.flags.binary=t,this}},function(t,e){t.exports=function(t,e){for(var n=[],r=(e=e||0)||0;r<t.length;r++)n[r-e]=t[r];return n}},function(t,e){t.exports=function(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}}},function(t,e){var n=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}},function(t,e){function n(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}}])}));un.io;class ln{constructor(){this.serverUrl="https://www.smartmapx.com",this.serverPath="/bg-geo-server/socket.io"}}return{PathFinder:Ne,RoadGraph:Zt,NearestLine:se,TextInstructions:class{constructor(t,e){t.steps.forEach((t,n)=>{e(t,n)})}},Navigation:tn,NavigationOptions:We,SimulateLocationEngine:class extends nn{constructor(t,e){super(),this.providerName="simulator",this.playIndex=-1,this.routeLeg=t,this.speed=e}getProvider(){return this.providerName}getLastLocation(t){const e=this.request&&this.request.interval?this.request.interval/2:200;this.lastLocation&&this.request?t(null,new Be([this.lastLocation])):setTimeout(()=>{this.getLastLocation(t)},e)}getLastLocationSync(){return this.lastLocation}setRouteLeg(t){this.routeLeg=t}resetRouteLeg(t){this.routeLeg=t,this.playIntervalResult&&(clearInterval(this.playIntervalResult),this.playIntervalResult=null),this.getSimulatePoints(),this.playIndex=0,this.playIntervalResult=setInterval(()=>{if(this.simulatePoints&&this.simulatePoints.length>this.playIndex){const t=this.simulatePoints[this.playIndex++];this.lastLocation=t;const e=new Be([t]);this.loopHandleLocationEngineCallbacks(null,e)}else this.stop()},this.request.interval)}stop(){this.playIntervalResult&&(clearInterval(this.playIntervalResult),this.playIntervalResult=null),this.callback=null,this.request=null,this.simulatePoints=null,this.lastLocation=null}start(t){this.request=t,this.getSimulatePoints(),this.playIndex=0,setTimeout(()=>{this.playIntervalResult=setInterval(()=>{if(this.simulatePoints&&this.simulatePoints.length>this.playIndex){const t=this.simulatePoints[this.playIndex++];this.lastLocation=t;const e=new Be([t]);this.loopHandleLocationEngineCallbacks(null,e)}else this.stop()},t.interval)},2e3)}getSimulatePoints(){const t=this.routeLeg.geometry.geometry.coordinates,e=new Array,n=R(t[0]);n.properties.type="depart",n.properties.heading=Dt(H(t[0],t[1])),e.push(this.pointToLocation(n));const r=this.request.interval*this.speed/1e6,i=St(this.routeLeg.geometry);let o=r;for(;o<i;){const t=_e(this.routeLeg.geometry,o);e.push(this.pointToLocation(t)),o+=r}const s=R(t[t.length-1]);s.properties.type="arrive",s.properties.heading=Dt(H(t[t.length-2],t[t.length-1])),e.push(this.pointToLocation(s)),this.simulatePoints=e}addTempPoint(t,e){}positionToLocation(t){const e=R(t);return this.pointToLocation(e)}pointToLocation(t){const e=new en;return e.provider=this.providerName,e.longitude=t.geometry.coordinates[0],e.latitude=t.geometry.coordinates[1],e.speed=this.speed,e.heading=t.properties.heading,e.time=(new Date).getTime(),e}},WeixinRemoteLocationEngine:class extends nn{constructor(t,e){super(),this.providerName="weixin_remote",this.clientId=t,this.options=Object.assign(new ln,e),this.wxGetLocationSuccessCallback=this.wxGetLocationSuccessCallback.bind(this)}getLastLocation(t){if(this.lastLocation)t&&t(null,new Be([this.lastLocation]));else{const e=this.request&&this.request.interval?this.request.interval/2:200;setTimeout(()=>{this.getLastLocation(t)},e)}}getLastLocationSync(){return this.lastLocation}getProvider(){return this.providerName}getClientId(){return this.clientId}getSocket(){return this.socket}clearZeroExcursion(t){if(!this.lastLocation||!this.lastLocation.accuracy||this.lastLocation.accuracy>100)return t;if(t.speed>0)return t;const e=this.lastLocation.accuracy;return 1e3*Y([t.longitude,t.latitude],[this.lastLocation.longitude,this.lastLocation.latitude])<=e&&(t.longitude=this.lastLocation.longitude,t.latitude=this.lastLocation.latitude,t.accuracy=this.lastLocation.accuracy),t}wxGetLocationSuccessCallback(t){const e=this.getLocation(t);this.clearZeroExcursion(e),this.lastLocation=e;const n=new Be([e]);this.loopHandleLocationEngineCallbacks(null,n)}start(t){if(this.socket)return;const e=un(this.options.serverUrl,{path:this.options.serverPath});e.on("locations",this.wxGetLocationSuccessCallback),e.on("connect",()=>{console.log("connect"),e.emit("register",{clientId:this.clientId})}),e.on("reconnect",t=>{console.log("reconnect",t)}),e.on("connect_error",t=>{console.log("connect_error",t)}),e.on("connect_timeout",t=>{console.log("connect_timeout",t)}),e.on("error",t=>{console.log("error",t)}),e.on("reconnect_error",t=>{console.log("reconnect_error",t)}),e.on("reconnect_failed",t=>{console.log("reconnect_failed",t)}),this.socket=e}stop(){this.socket&&(this.socket.close(),this.socket=null)}getLocation(t){const e=new en;return e.provider=t.provider||this.providerName,e.longitude=t.longitude,e.latitude=t.latitude,e.longitude_ori=t.longitude,e.latitude_ori=t.latitude,e.speed=-1===t.speed?void 0:t.speed,e.accuracy=t.accuracy,e.altitude=t.altitude,e.altitudeAccuracy=t.verticalAccuracy,e.heading=-1===t.direction?void 0:t.direction,e.deviceNo=t.clientId||t.truck_no,e.time=Date.now(),e}},LocationEngineRequest:rn,HtmlVoicePlayer:hn,HtmlVoicePlayerOptions:on,version:"2.8.0"}}));
